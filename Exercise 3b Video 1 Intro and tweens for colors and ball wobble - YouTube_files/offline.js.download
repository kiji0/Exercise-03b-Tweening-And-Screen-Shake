(function(g){var window=this;'use strict';var HJ=function(){Mt.apply(this,arguments)},oNo=function(){HJ.apply(this,arguments)},fKo=function(v,F){this.B=v;
this.j=F;this.L={}},VX=function(v){g.q.call(this);
var F=this;this.api=v;this.gZ={BqS:function(){return F.B},
VNz:function(){return F.j}};
typeof g.C7.BroadcastChannel!=="undefined"&&(this.B=new g.C7.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.tb()),this.B.onmessage=this.L.bind(this),this.j=new g.C7.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.tb()),this.j.onmessage=this.C.bind(this))},MH_=function(v){var F,c,S;
return g.M(function(J){if(J.B==1)return v?g.H(J,jb(v,g.Mn,"mainDownloadsListEntity"),2):J.return([]);F=J.j;return((c=F)==null?0:(S=c.downloads)==null?0:S.length)?J.return(F.downloads.map(function(A){var C;return(C=A.videoItem)!=null?C:""})):J.return([])})},HM7=function(){HJ.apply(this,arguments)},VHt=function(){HJ.apply(this,arguments)},j2_=function(v){var F=v.videos;
v=[];var c=[];if(F){F=g.k(F);for(var S=F.next();!S.done;S=F.next()){var J=S.value.offlineVideoData.videoId;S=g.DB(J,"musicTrack");J=g.DB(J,"musicTrackDownloadMetadataEntity");v.push(S);c.push(J)}}return{Cj:v,R4:c}},mSo=function(){HJ.apply(this,arguments)},$SO=function(v,F){if(F)for(var c=0;c<v.actions.length;c++)if(F==="!*$_ALL_ENTITIES_!*$"&&v.actions[c].actionId!==F||F!=="!*$_ALL_ENTITIES_!*$"&&v.actions[c].rootActionId===F&&v.actions[c].actionId!==F)v.actions.splice(c,1),c--},XA7=function(){HJ.apply(this,
arguments)},ZMZ=function(){HJ.apply(this,arguments)},IKI=function(v){var F,c,S,J,A,C,P,z;
return g.M(function(U){switch(U.B){case 1:return F=g.S6(),c=Kpj(v),S=g.Es(qnj),g.f1(U,2),A={Rk:!0},g.H(U,g.dj(F,c,S,void 0,A),4);case 4:J=U.j;g.Ek(U,3);break;case 2:C=g.Lf(U);if(C instanceof g.iR)throw P="GetOffline network manager error for playlist: "+C.message,m9(P,C),Error(P);m9("GetOffline fetch request error for playlist",C);throw Error("GetOffline fetch request error for playlist");case 3:z=$H(J);if(!J)throw m9("Network request failed for playlist"),Error("Network request failed for playlist");
if(z!==void 0)Xr(z,"playlist");else if(!J.playlists||!J.playlists.length)throw m9("No data for playlist"),Error("No data for playlist");return U.return(J.playlists.map(function(n){return n.offlinePlaylistData}))}})},gNd=function(v){return g.Uk((0,g.AXt)(),v)},yV7=function(){HJ.apply(this,arguments)},Fa7=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O;
return g.M(function(a){switch(a.B){case 1:return c=Zg(F),S=g.Bx(F.entityKey),J=S.entityId,A=[],g.f1(a,2),g.H(a,bMd(v,J),4);case 4:A=a.j;if(!(v.Y.D("woffle_enable_main_downloads_library")&&((C=A)==null?0:C.length))){a.A$(5);break}return g.H(a,tHH(v.B,[F.entityKey]),5);case 5:g.Ek(a,3);break;case 2:return P=g.Lf(a),z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.V$&&P.type==="QUOTA_EXCEEDED"?(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):m9("Playlist add error"),a.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,z,U));case 3:n=[];if(!v.Y.D("html5_offline_prevent_redownload_downloaded_video")){a.A$(7);break}return g.H(a,pA7(v.B,"mainVideoEntity",A),8);case 8:A=a.j;case 7:if((r=A)==null?0:r.length)for(h=g.k(A),Q=h.next();!Q.done;Q=h.next())if(u=Q.value,D=u.offlineVideoData,w=void 0,(w=D)==null?0:w.videoId)G=void 0,O=Number(((G=F.actionMetadata)==null?void 0:G.priority)||
0)+1,n.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",D.videoId,"mainVideoEntity",O,Ix,vJO(F,D,J)));return a.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,n))}})},SI_=function(v,F){var c,S,J;
return g.M(function(A){switch(A.B){case 1:c=Zg(F);g.f1(A,2);S=g.Bx(F.entityKey).entityId;if(S==="!*$_ALL_ENTITIES_!*$")return g.H(A,cUf(v.B),5);J=g.DB(S,"videoPlaybackPositionEntity");return g.H(A,slI(v.B,J),5);case 5:g.Ek(A,3);break;case 2:return g.Lf(A),A.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},JU7=function(v,F){var c;
return g.M(function(S){if(!v.B)return S.return();c=v.B;return g.H(S,gX(v.j,{mode:"readwrite",cX:!0},function(J){var A=[yX(J,c,"transfer")];F&&A.push(F(J));return g.zo.all(A)}),0)})},AUI=function(v){return v instanceof Error?new bH("UNKNOWN_DECODE_ERROR",{originalMessage:v.message}):new bH("UNKNOWN_DECODE_ERROR")},zPY=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6,dO,p7,Y,H_,PQ,yZ,ea,aO,B,p,R1,zh,fN,rL,v_,sr,Ej,R,W,l,L,I,P3,K,sa,f,Oa,L1,Dd,Ea,Vt,YW,I1,Fu,
sj,a5,pU,o5,lt;
return g.M(function(XJ){switch(XJ.B){case 1:return c=Zg(F),S=F.entityKey,J=g.Bx(S).entityId,A=[],C=!1,J==="!*$_ALL_ENTITIES_!*$"?(C=!0,g.H(XJ,tC(v.B,"musicPlaylist"),5)):g.H(XJ,jb(v.B,S,"musicPlaylist"),4);case 4:(P=XJ.j)&&A.push(P);XJ.A$(3);break;case 5:A=XJ.j;case 3:if((z=A)==null||!z.length)return XJ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));U=g.x(F.actionMetadata,CLo);r=(n=U)==null?void 0:n.autoSync;h=[];u=Q=!0;D=!1;w=void 0;if(!C&&r===!1){XJ.A$(6);break}g.f1(XJ,7);return g.H(XJ,
ePo(0,!!r,!0,A),9);case 9:h=XJ.j;g.Ek(XJ,8);break;case 7:G=g.Lf(XJ);if(!(G instanceof Error&&G.message==="No data")){G instanceof Error&&G.message==="Empty response body"&&m9(G.message);XJ.A$(8);break}return J==="!*$_ALL_ENTITIES_!*$"?g.H(XJ,p_(v.B,F,v.L),8):g.H(XJ,vi(J,"musicPlaylist",v.B,F,v.L),8);case 8:if(!h.length||!C&&h[0].playlistId!==J)return XJ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));case 6:if(C){O=[];a=g.k(h);for(T=a.next();!T.done;T=a.next())m=T.value,m.upToDate||
r&&!m.shouldAutoSyncMetadata||!m.playlistId||(b={autoSync:r},O.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",m.playlistId,"musicPlaylist",0,F8,{musicPlaylistEntityActionMetadata:b})));return XJ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,O))}h.length&&(X=h[0],D=!!X.upToDate,r&&(Q=(AJ=X.shouldAutoSyncMetadata)!=null?AJ:!0,u=(C1=X.shouldAutoSyncVideos)!=null?C1:!0,X.checkInSeconds&&(w=X.checkInSeconds)));if(D||!Q)return XJ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));c3=[];n1=A[0];FJ=void 0;if(!n1.downloadMetadata){XJ.A$(15);break}return g.H(XJ,jb(v.B,n1.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:xW=XJ.j,FJ=Number((zf=(tJ=xW)==null?void 0:tJ.addedTimestampMillis)!=null?zf:"0")/1E3;case 15:return g.f1(XJ,17),g.H(XJ,PLd(v,J,(eY=FJ)==null?void 0:eY.toString(),w),19);case 19:c3=XJ.j;g.Ek(XJ,18);break;case 17:T6=g.Lf(XJ);if(!(T6 instanceof Error&&T6.message==="No data")){if(T6 instanceof Error&&T6.message==="Empty response body")m9(T6.message);
else return dO="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p7="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T6 instanceof g.V$&&T6.type==="QUOTA_EXCEEDED"&&(dO="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",p7="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),XJ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,dO,p7));XJ.A$(18);break}return g.H(XJ,vi(J,"musicPlaylist",v.B,F,v.L),18);case 18:if(!u)return XJ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));Y=[];H_=new Map;if((PQ=c3)==null?0:PQ.length)for(yZ=g.k(c3),ea=yZ.next();!ea.done;ea=yZ.next())aO=ea.value,B=aO.offlineVideoData,p=void 0,((p=B)==null?0:p.videoId)&&H_.set(B.videoId,B);R1=new Map;zh=[];if((fN=n1)==null?0:(rL=fN.tracks)==null?0:rL.length)for(v_=g.k(n1.tracks),sr=v_.next();!sr.done;sr=v_.next())if(Ej=sr.value,R=g.Bx(Ej).entityId)H_.has(R)?(R1.set(R,H_.get(R)),H_.delete(R)):zh.push(R);l=Number(((W=F.actionMetadata)==null?void 0:W.priority)||0)+1;L=g.k(H_.entries());for(I=L.next();!I.done;I=
L.next())P3=I.value,K=g.k(P3),sa=K.next().value,f=K.next().value,Oa=sa,L1=f,Y.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Oa,"musicTrack",l,F8,ci(F,L1)));Dd=g.k(R1.entries());for(Ea=Dd.next();!Ea.done;Ea=Dd.next())Vt=Ea.value,YW=g.k(Vt),I1=YW.next().value,Fu=YW.next().value,sj=I1,a5=Fu,Y.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",sj,"musicTrack",l,F8,ci(F,a5)));pU=g.k(zh);for(o5=pU.next();!o5.done;o5=pU.next())lt=o5.value,Y.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",lt,"musicTrack",
0,F8));return XJ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,Y))}})},jb=function(v,F,c){return gX(v,{mode:"readonly",
cX:!0},function(S){return sO(S,F,c)})},U5_=function(){HJ.apply(this,arguments)},nJj=function(){HJ.apply(this,arguments)},hPZ=function(v){var F;
return g.M(function(c){F=g.x(v.frameworkUpdates,S2);return v.frameworkUpdates&&F?g.H(c,rUt(F),0):c.return()})},Qlr=function(){HJ.apply(this,arguments)},NFY=function(v,F){var c,S;
return g.M(function(J){switch(J.B){case 1:return c=Zg(F),g.f1(J,2),S=g.Bx(F.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.H(J,p_(v.B,F,v.L),5):g.H(J,Jq(S,v.B,F,v.L),6);case 6:return g.H(J,uUo(v.B,F.entityKey),5);case 5:g.Ek(J,3);break;case 2:return g.Lf(J),J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},kQr=function(v){return new g.Eg(function(F,c){var S=v.length,J=[];
if(S)for(var A=function(U){c(U)},C=function(U,n){S--;
J[U]=n;S==0&&F(J)},P,z=0;z<v.length;z++)P=v[z],g.iL2(P,g.lR(C,z),A);
else F(J)})},i3_=function(v,F){this.B=v;
this.L=F},D5Y=function(v,F){var c,S,J,A,C;
return g.M(function(P){if(P.B==1)return c=g.Bx(F.key),S=c.entityId,J=g.DB(S,"playbackData"),g.H(P,jb(v.j,J,"playbackData"),2);A=P.j;if((C=A)==null?0:C.playerResponseJson)return P.return(JSON.parse(A.playerResponseJson));throw Error("No PlayerResponse found");})},wbz=function(v,F,c,S,J){var A,C,P,z,U,n;
return g.M(function(r){switch(r.B){case 1:if(A=S){r.A$(2);break}return g.H(r,x5d([F]),3);case 3:C=r.j,P=C[0],A=War(P);case 2:return g.H(r,BF7(v,A,F,J,c),4);case 4:z=r.j;U=z.musicTrackEntity;n=z.iV;var h=Aq(U.thumbnailDetails),Q=[];n&&(Q=Aq(n.thumbnailDetails));return g.H(r,CK(h.concat(Q)),0)}})},RPj=function(){HJ.apply(this,arguments)},tC=function(v,F,c){return gX(v,{mode:"readonly",
cX:!0},function(S){return e2(S,F,c)})},O37=function(){HJ.apply(this,arguments)},BF7=function(v,F,c,S,J){var A;
return g.M(function(C){return C.B==1?(J||(J=Date.now().toString()),A={id:g.DB(c,"musicTrackDownloadMetadataEntity"),playbackData:g.DB(c,"playbackData"),addedTimestampMillis:J,videoDownloadContextEntity:g.DB(c,"videoDownloadContextEntity")},S&&(F.albumRelease=S.id),g.H(C,gX(v.B,{mode:"readwrite",cX:!0},function(P){var z=[],U=yX(P,A,"musicTrackDownloadMetadataEntity");z.push(U);U=yX(P,F,"musicTrack");z.push(U);S&&(P=yX(P,S,"musicAlbumRelease"),z.push(P));return g.zo.all(z)}),2)):C.B!=3?g.H(C,Pi(c,"musicTrackDownloadMetadataEntity",
v.B,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):C.return({musicTrackEntity:F,
iV:S})})},UO=function(v,F,c,S){var J;
return g.M(function(A){if(A.B==1){if(!v.B)return zV(v,"saveTransferState: "+F),A.return();v.B.transferState=F;v.B.failureReason=S;g.f1(A,2);return g.H(A,JU7(v,function(C){return c?e2(C,"offlineVideoStreams",v.B.offlineVideoStreams).then(function(P){for(var z=g.k(P),U=z.next();!U.done;U=z.next())if((U=U.value)&&U.streamsProgress){U=g.k(U.streamsProgress);for(var n=U.next();!n.done;n=U.next())n.value.streamState=c}return lTZ(C,P.filter(function(r){return!!r}),"offlineVideoStreams")}):g.zo.resolve(void 0)}),
4)}if(A.B!=2)return g.Ek(A,0);
J=g.Lf(A);return J instanceof g.V$&&J.type==="QUOTA_EXCEEDED"?g.H(A,v.mN("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):A.A$(0)})},YI7=function(v){this.Eb=v;
this.B=void 0},GQf=function(){HJ.apply(this,arguments)},EJ7=function(){HJ.apply(this,arguments)},d5r=function(){HJ.apply(this,arguments)},aTI=function(){Mt.apply(this,arguments)},Lat=function(v,F,c){var S,J,A,C,P,z,U,n;
return g.M(function(r){switch(r.B){case 1:S=g.S6();var h=c.refreshData,Q=c.isEnqueuedForExpiredStreamUrlRefetch,u=c.gz,D=c.offlineSourceData,w=c.mediaCapabilities,G={entityKey:v};h&&(G.refreshData=h);Q&&(G.isExpiredStreamUrlRefetch=Q);u&&(G.downloadParameters=u);D&&(G.offlineSourceData=D);h={context:g.ai(F),signatureTimestamp:20356,videos:[G]};w&&(h.mediaCapabilities=w);J=h;A=g.Es(TFd);g.f1(r,2);P={Rk:!0};return g.H(r,g.dj(S,J,A,void 0,P),4);case 4:C=r.j;g.Ek(r,3);break;case 2:z=g.Lf(r);if(z instanceof
g.iR)throw U="GetPDE network manager error: "+z.message,m9(U,z),Error(U);m9("GetPDE fetch request error",z);throw Error("GetPDE fetch request error");case 3:n=$H(C);if(C)n!==void 0&&Xr(n,"PDE");else throw m9("Network request failed for PDE"),Error("Network request failed for PDE");return r.return(C)}})},oJY=function(){HJ.apply(this,arguments)},Mfo=function(v){return g.Uk(fT7(),v)},H3O=function(){HJ.apply(this,arguments)},slI=function(v,F){return gX(v,{mode:"readwrite",
cX:!0},function(c){return nK(c,F)})},nK=function(v,F,c){if(c==null?0:c.nx){var S=new Set;
return Vfj(v,F,S).then(function(){for(var A=[],C=g.k(S),P=C.next();!P.done;P=C.next())A.push(nK(v,P.value));return g.zo.all(A).then(function(){})})}var J=g.Bx(F).entityType;
return g.zo.all([v.B.objectStore("EntityStore").delete(F),jl7(v,F)]).then(function(){r0(v,F,J)})},m5Z=function(){HJ.apply(this,arguments)},$5d=function(){HJ.apply(this,arguments)},XbH=function(){HJ.apply(this,arguments)},IT7=function(v,F){var c,S,J,A;
return g.M(function(C){switch(C.B){case 1:return c=Zg(F),g.f1(C,2),S=g.Bx(F.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.H(C,Z3j(v.B,F,v.L,(J=F.actionMetadata)==null?void 0:(A=J.offlineLoggingData)==null?void 0:A.offlineDeleteReason),5):g.H(C,KaI(S,v.B,F,v.L),6);case 6:if(!v.Y.D("woffle_enable_main_downloads_library")){C.A$(5);break}return g.H(C,qIr(v.B,F.entityKey),5);case 5:g.Ek(C,3);break;case 2:return g.Lf(C),C.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return C.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},gJ7=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a;
return g.M(function(T){if(T.B==1)return c=g.DB("main_downloads_library_id","mainDownloadsLibraryEntity"),S=g.DB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.H(T,gX(v,{mode:"readonly",cX:!0},function(m){return g.zo.all([sO(m,c,"mainDownloadsLibraryEntity"),sO(m,S,"mainDownloadsListEntity")])}),2);
J=T.j;A=g.k(J);C=A.next().value;P=A.next().value;z=C;U=P;z||(z={id:c});n=g.k(F);for(r=n.next();!r.done;r=n.next())if(h=r.value,h===g.Mn){if(z.smartDownloadsList)return T.return();z.smartDownloadsList=h}else if(Q=g.Bx(h).entityType,u={},Q==="mainPlaylistEntity"?u.playlistItem=h:Q==="mainVideoEntity"&&(u.videoItem=h),!g.jt(u)){D=void 0;if((D=U)==null?0:D.downloads){w=!1;G=g.k(U.downloads);for(O=G.next();!O.done;O=G.next())if(a=O.value,a.playlistItem===h||a.videoItem===h){w=!0;break}w||U.downloads.push(u)}else U=
{id:S,downloads:[u]};z.downloadsList=S}return T.return({mainDownloadsLibraryEntity:z,mainDownloadsListEntity:U})})},yUf=function(v){switch(v.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},b37=function(v){return new bH("WRONG_DATA_TYPE",{vP:v})},pb7=function(v,F){F=F===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":F;
var c,S,J,A;return g.M(function(C){if(C.B==1)return v.B||zV(v,"setTransferToFailed: "+F),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F==="TRANSFER_FAILURE_REASON_NETWORK"?c="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":F==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.H(C,UO(v,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",F),2);if(C.B!=3)return hq(v.Mk,{entityKey:(S=v.B)==null?void 0:S.key,failureReason:c}),
J=v.B?g.Bx(v.B.key).entityId:"",g.H(C,Qx(v,J),3);A=C.j;var P={videoId:J,ZG:v.B,offlineModeType:A},z=F,U={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};z&&(U.transferFailureReason=z,U.failureReason=tfo(z));u$(U,P);g.jo(C)})},sZt=function(v,F,c,S){var J=vld(v.j,1);
return sO(v,F,S).then(function(A){if(A){A=g.yl(A,c);var C={key:F,entityType:S,data:FSI(J,A,F),version:1};return g.zo.all([g.zx(v.B.objectStore("EntityStore"),C),cYo(v,A,S)])}}).then(function(){r0(v,F,S);
return F})},NA=function(v,F){var c=this;
this.Y=v;this.api=F;this.K=new g.y6;this.V=new g.jL;this.gZ={cO:function(){return c.L.gZ.cO()},
Iq:function(){return c.K},
R4k:function(){return c.L},
PS:function(){return c.PS()},
jd:function(){return c.jd()},
fZ:function(){return c.fZ()},
wm:function(){return c.wm()},
ek:function(){return c.ek()},
AE:function(S){return c.AE(S)}};
this.L=new Syd(function(){return JYf(c)},function(){c.fZ()},this.api.To(),this.api.D.bind(this.api));
this.B=new VX(this.api);AYt(this.L)},$H=function(v){var F;
return(F=v.errorMetadata)==null?void 0:F.status},CMt=function(){HJ.apply(this,arguments)},PMZ=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6,dO,p7,Y,H_,PQ,yZ,ea,aO,B,p,R1,zh,fN,rL,v_,sr,Ej,R,W,l,L,I,P3,K,sa,f,Oa;
return g.M(function(L1){switch(L1.B){case 1:return c=Zg(F),S=F.entityKey,J=g.Bx(S).entityId,A=[],C=!1,J==="!*$_ALL_ENTITIES_!*$"?(C=!0,g.H(L1,tC(v.B,"musicAlbumRelease"),5)):g.H(L1,jb(v.B,S,"musicAlbumRelease"),4);case 4:(P=L1.j)&&A.push(P);L1.A$(3);break;case 5:A=L1.j;case 3:if((z=A)==null||!z.length)return L1.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));if(C){U=[];n=g.k(A);for(r=n.next();!r.done;r=n.next())h=r.value,Q=g.Bx(h.id).entityId,U.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Q,"musicAlbumRelease",0,kT));return L1.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,U))}u=[];D=A[0];w=void 0;if(!D.downloadMetadata){L1.A$(6);break}return g.H(L1,jb(v.B,D.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:G=L1.j,w=Number((a=(O=G)==null?void 0:O.addedTimestampMillis)!=null?a:"0")/1E3;case 6:return g.f1(L1,8),g.H(L1,ecZ(v,J,(T=w)==null?void 0:T.toString()),10);case 10:u=L1.j;g.Ek(L1,9);break;case 8:m=g.Lf(L1);if(!(m instanceof Error&&m.message===
"No data")){if(m instanceof Error&&m.message==="Empty response body")m9(m.message);else return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.V$&&m.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L1.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,b,X));L1.A$(9);break}return g.H(L1,vi(J,"musicAlbumRelease",v.B,
F,v.L),9);case 9:AJ=[];C1=new Map;if((c3=u)==null?0:c3.length)for(n1=g.k(u),FJ=n1.next();!FJ.done;FJ=n1.next())xW=FJ.value,tJ=xW.offlineVideoData,zf=void 0,((zf=tJ)==null?0:zf.videoId)&&C1.set(tJ.videoId,tJ);eY=new Map;T6=[];if((dO=D)==null?0:(p7=dO.tracks)==null?0:p7.length)for(Y=g.k(D.tracks),H_=Y.next();!H_.done;H_=Y.next())if(PQ=H_.value,yZ=g.Bx(PQ).entityId)C1.has(yZ)?(eY.set(yZ,C1.get(yZ)),C1.delete(yZ)):T6.push(yZ);aO=Number(((ea=F.actionMetadata)==null?void 0:ea.priority)||0)+1;B=g.k(C1.entries());
for(p=B.next();!p.done;p=B.next())R1=p.value,zh=g.k(R1),fN=zh.next().value,rL=zh.next().value,v_=fN,sr=rL,AJ.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v_,"musicTrack",aO,kT,ci(F,sr)));Ej=g.k(eY.entries());for(R=Ej.next();!R.done;R=Ej.next())W=R.value,l=g.k(W),L=l.next().value,I=l.next().value,P3=L,K=I,AJ.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P3,"musicTrack",aO,kT,ci(F,K)));sa=g.k(T6);for(f=sa.next();!f.done;f=sa.next())Oa=f.value,AJ.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Oa,"musicTrack",0,kT));return L1.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,AJ))}})},zc7=function(){Mt.apply(this,arguments)},Vfj=function(v,F,c){if(c.has(F))return g.zo.resolve(void 0);
c.add(F);return UxZ(v,F).then(function(S){return v.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(F)).then(function(){return S})}).then(function(S){var J=g.zo.resolve(void 0);
S=g.k(S);for(var A=S.next(),C={};!A.done;C={IX:void 0},A=S.next())C.IX=A.value,J=J.then(function(P){return function(){return Vfj(v,P.IX,c)}}(C));
return J}).then(function(){})},r0=function(v,F,c){var S=v.L[c];
S||(S=new Set,v.L[c]=S);S.add(F)},rYd=function(v){var F;
return g.M(function(c){if(c.B==1)return g.H(c,nl7(v),2);F=c.j;g.wo("offlineStateSnapshot",F);g.jo(c)})},gX=function(v,F,c){var S,J,A,C;
return g.M(function(P){if(P.B==1)return g.H(P,Mfo(v.token),2);if(P.B!=3)return S=P.j,g.H(P,g.Hu(S,["EntityStore","EntityAssociationStore"],F,function(z){J=new fKo(z,v.B);return c(J)}),3);
A=P.j;J&&(C=J.L,Object.keys(C).length>0&&(v.channel.postMessage(C),hcf(v,C)));return P.return(A)})},Mt=function(v){this.B=v},Nnj=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u;
return g.M(function(D){switch(D.B){case 1:return c=Zg(F),S=g.Bx(F.entityKey),J=S.entityId,A=g.x(F.actionMetadata,i$),P=!((C=A)==null?0:C.playlistId),g.f1(D,2),g.H(D,QZH(v,J,void 0,(z=A)==null?void 0:z.offlineVideoData,P),4);case 4:g.Ek(D,3);break;case 2:return U=g.Lf(D),n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.V$&&U.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
D.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,n,r));case 3:h=1;h=Number(((Q=F.actionMetadata)==null?void 0:Q.priority)||0)+1;var w=(w=g.x(F.actionMetadata,i$))?{playbackDataActionMetadata:{maximumDownloadQuality:w.maximumDownloadQuality}}:void 0;u=qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"playbackData",h,uRd,w);return D.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,[u]))}})},kdY=function(){HJ.apply(this,arguments)},icd=function(){HJ.apply(this,arguments)},
R8=function(v,F,c,S,J){var A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6,dO,p7;
return g.M(function(Y){switch(Y.B){case 1:return A=g.DB(v,"mainVideoEntity"),C=g.DB(v,"ytMainChannelEntity"),P=g.DB(v,"transfer"),z=g.DB(v,"videoDownloadContextEntity"),g.H(Y,gX(F,{mode:"readonly",cX:!0},function(H_){return g.zo.all([sO(H_,A,"mainVideoEntity"),sO(H_,C,"ytMainChannelEntity"),sO(H_,P,"transfer"),sO(H_,z,"videoDownloadContextEntity"),e2(H_,"ytMainChannelEntity"),e2(H_,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:U=Y.j;n=g.k(U);r=n.next().value;h=n.next().value;Q=n.next().value;u=n.next().value;D=n.next().value;w=n.next().value;G=r;O=h;a=Q;T=u;m=D;b=w;if(!G&&!O){Y.A$(3);break}X=G?Aq(G.thumbnail):[];if(!O){AJ=[];Y.A$(4);break}return g.H(Y,Dxz(O,m),5);case 5:AJ=Y.j;case 4:return C1=AJ,g.H(Y,DA(X.concat(C1)),3);case 3:c3=[];n1=g.DB(v,"downloadStatusEntity");FJ=g.k(b);for(xW=FJ.next();!xW.done;xW=FJ.next())tJ=xW.value,zf=g.Bx(tJ.key).entityId,eY=xT(tJ),T6=g.Bx(eY.action.entityKey).entityId,zf!==v&&T6!==
v||Wi(c,tJ.actionProto)||c3.push(tJ.key);return g.H(Y,gX(F,{mode:"readwrite",cX:!0},function(H_){var PQ=c3.map(function(yZ){return nK(H_,yZ)});
PQ.push(nK(H_,A,{nx:!0}));PQ.push(nK(H_,n1,{nx:!0}));return g.zo.all(PQ)}),7);
case 7:p7=(dO=T)==null?void 0:dO.offlineModeType,J&&(Bi(J),J.offlineModeType&&(p7=J.offlineModeType)),w0(a,p7),hq(S,{entityKey:A,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.jo(Y)}})},xxZ=function(){},WSO=function(v){var F,c;
return g.M(function(S){if(S.B==1)return g.H(S,g.Lc(),2);if(S.B!=3)return(F=S.j)?g.H(S,g.G7(F),3):S.return();c=S.j;return S.return(g.Hu(c,["index","media","captions"],{mode:"readwrite",cX:!0},function(J){var A=IDBKeyRange.bound(v+"|",v+"~");J=[J.objectStore("index").delete(A),J.objectStore("media").delete(A),J.objectStore("captions").delete(A)];return g.zo.all(J).then(function(){})}))})},BnI=function(){},hcf=function(v,F){v=g.k(v.observers);
for(var c=v.next();!c.done;c=v.next())c=c.value,c(F)},wWZ=function(v,F,c){var S,J,A,C,P;
return g.M(function(z){if(z.B==1){if(!F.frameworkUpdates||!g.x(F.frameworkUpdates,S2))return z.return();if(!(g.x(F.frameworkUpdates,S2).mutations&&g.x(F.frameworkUpdates,S2).mutations.length>0&&g.x(F.frameworkUpdates,S2).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return z.A$(2);S=g.Bx(g.x(F.frameworkUpdates,S2).mutations[0].entityKey).entityId;return g.H(z,OO(v.B,S),3)}if(z.B!=2){J=z.j;A=g.x(c.actionMetadata,l$);if(P=(C=A)==null?void 0:C.playlistId)J.playlistId=P;J.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.j3(v.Y)?g.H(z,R8(S,v.B,c,v.L,J),2):g.Gk(v.Y)?g.H(z,Jq(S,v.B,c,v.L),2):z.A$(2)}return g.H(z,rUt(g.x(F.frameworkUpdates,S2)),0)})},Rcj=function(v,F){return{id:v,
channelId:F.channelId,title:F.title,avatar:F.thumbnail}},GV=function(v,F,c){return gX(v,{mode:"readwrite",
cX:!0},function(S){return yX(S,F,c)})},e2=function(v,F,c){return c?(c=c.map(function(S){return sO(v,S,F)}),g.zo.all(c)):v.B.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(F)).then(function(S){return S.map(function(J){return Ocf(v,J)})})},bH=function(v,F){F=F===void 0?{}:F;
g.VS.call(this,g.CqH[v],Object.assign({},{name:"PESEncoderError",type:v},F));this.type=v;this.level="WARNING";Object.setPrototypeOf(this,bH.prototype)},lhd=function(){HJ.apply(this,arguments)},Yyo=function(){HJ.apply(this,arguments)},Gd_=function(){HJ.apply(this,arguments)},Elj=function(){HJ.apply(this,arguments)},ahI=function(v,F,c,S){if(!v.action.entityKey)throw Error("entityKey is missing.");
var J=g.Bx(v.action.entityKey);J={entityType:J.SC,entityId:J.entityId,offlineOrchestrationActionType:v.action.actionType,orchestrationAction:{orchestrationActionId:v.actionId}};F&&(J.offlineOrchestrationActionResult=F.status,J.isRetryable=c?!1:F.B,F.L&&(J.offlineOrchestrationFailureReason=dxo(F.L,J.isRetryable)));var A,C;if((A=v.action.actionMetadata)==null?0:(C=A.offlineLoggingData)==null?0:C.offlineModeType)J.offlineModeType=v.action.actionMetadata.offlineLoggingData.offlineModeType;S&&(J.additionalOrchestrationActions=
S.map(function(P){return{orchestrationActionId:P.actionId}}));
return J},LS7=function(v){var F=v.B.actions[0];
return v.C?((F==null?void 0:F.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&v.C[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(v.V=!0),Promise.resolve()):Tno(v)},olr=function(){HJ.apply(this,arguments)},EO=function(v){this.B=v},fh_=function(){HJ.apply(this,arguments)},MmO=function(v,F){var c,S;
return g.M(function(J){if(J.B==1)return g.H(J,g.Lc(),2);if(J.B!=3){c=J.j;if(!c)throw g.x_("wct");return g.H(J,g.G7(c),3)}S=J.j;return g.H(J,g.Hu(S,["captions"],{mode:"readwrite",cX:!0},function(A){var C=[];A=A.objectStore("captions");for(var P=0;P<F.length;P++){var z=g.zx(A,F[P],v+"|"+F[P].metadata.vss_id);C.push(z)}return g.zo.all(C)}),0)})},Hc7=function(){Mt.apply(this,arguments)},Vm7=function(){HJ.apply(this,arguments)},jZZ=function(){this.actions=[]},mxZ=function(v,F){this.B=v;
this.Y=F},KaI=function(v,F,c,S){var J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6,dO,p7,Y,H_,PQ,yZ,ea,aO,B,p,R1,zh,fN,rL,v_,sr,Ej,R,W,l;
return g.M(function(L){switch(L.B){case 1:return J=g.DB(v,"mainPlaylistEntity"),A=g.DB(v,"ytMainChannelEntity"),g.H(L,gX(F,{mode:"readonly",cX:!0},function(I){return g.zo.all([sO(I,J,"mainPlaylistEntity"),sO(I,A,"ytMainChannelEntity"),e2(I,"mainPlaylistEntity"),e2(I,"mainDownloadsListEntity"),e2(I,"ytMainChannelEntity"),e2(I,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:C=L.j;P=g.k(C);z=P.next().value;U=P.next().value;n=P.next().value;r=P.next().value;h=P.next().value;Q=P.next().value;u=z;D=U;w=n;G=r;O=h;a=Q;if(!u&&!D){L.A$(3);break}T=u?$xH(u):[];if(!D){m=[];L.A$(4);break}return g.H(L,Dxz(D,O),5);case 5:m=L.j;case 4:return b=m,g.H(L,DA(T.concat(b)),3);case 3:X=[];AJ=new Map;if(!u){L.A$(7);break}return g.H(L,XWZ(u,w,G),8);case 8:X=L.j;C1=g.k(X);for(c3=C1.next();!c3.done;c3=C1.next())n1=c3.value,AJ.set(n1,{videoId:n1,playlistId:v,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.H(L,gX(F,{mode:"readonly",cX:!0},function(I){return g.zo.all([e2(I,"transfer"),e2(I,"videoDownloadContextEntity")])}),9);
case 9:FJ=L.j;xW=g.k(FJ);tJ=xW.next().value;zf=xW.next().value;eY=tJ;T6=zf;dO=g.k(eY);for(p7=dO.next();!p7.done;p7=dO.next())Y=p7.value,H_=g.Bx(Y.key).entityId,(PQ=AJ.get(H_))&&Y&&(PQ.cotn=Y.cotn);yZ=g.k(T6);for(ea=yZ.next();!ea.done;ea=yZ.next())aO=ea.value,B=g.Bx(aO.key).entityId,(p=AJ.get(B))&&aO&&(p.offlineModeType=aO.offlineModeType);case 7:R1=[];zh=g.k(a);for(fN=zh.next();!fN.done;fN=zh.next())rL=fN.value,v_=g.Bx(rL.key).entityId,sr=xT(rL),v_!==v&&sr.rootActionId!==v||Wi(c,rL.actionProto)||
R1.push(rL.key);Ej=g.DB(v,"mainPlaylistEntity");return g.H(L,gX(F,{mode:"readwrite",cX:!0},function(I){var P3=R1.map(function(K){return nK(I,K)});
P3.push(nK(I,Ej,{nx:!0}));return g.zo.all(P3)}),10);
case 10:if(!u){L.A$(0);break}X.reverse();if(!X){L.A$(0);break}R=g.k(X);W=R.next();case 13:if(W.done){L.A$(0);break}l=W.value;return g.H(L,R8(l,F,c,S,AJ.get(l)),14);case 14:W=R.next(),L.A$(13)}})},d0=function(v){v.B=void 0;
v.V=void 0;v.C.stop()},KS7=function(v,F){var c,S,J,A,C,P,z,U,n,r;
return g.M(function(h){switch(h.B){case 1:return c=g.S6(),g.H(h,a8(),2);case 2:S=h.j;if(!S){h.A$(3);break}return g.H(h,nl7(S),4);case 4:J=h.j;case 3:var Q=J;A={context:g.dk(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:v},offlineClientState:Q,clientStateRequestData:{preferredFormatType:F}}}};C=g.Es(Zcd);g.f1(h,5);z={Rk:!0};return g.H(h,g.dj(c,A,C,void 0,z),7);case 7:P=h.j;g.Ek(h,6);break;case 5:U=g.Lf(h);if(U instanceof g.iR)throw n=
"DPS network manager error for smart downloads: "+U.message,m9(n,U),Error(n);m9("DPS fetch request error for smart downloads",U);throw Error("DPS fetch request error for smart downloads");case 6:r=$H(P);if(P)r!==void 0&&Xr(r,"smart downloads");else throw m9("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return h.return(P)}})},rUt=function(v){var F;
return g.M(function(c){if(c.B==1){F=v.mutations;if(!F||F.length<=0)return c.return();if(g.Y9){var S={type:"ENTITY_LOADED"};F!==void 0&&(S.payload=F);g.Y9.dispatch(S)}return g.H(c,qyZ(F),2)}F.length=0;g.jo(c)})},Ihz=function(v,F){v=g.k(v.actions);
for(var c=v.next();!c.done;c=v.next())if(c.value.actionId===F)return!0;return!1},glH=function(v){if(v==null?0:v.streamsProgress){var F=0;
v=v.streamsProgress;for(var c=0;c<v.length;c++){var S=v[c];isNaN(Number(S.numBytesDownloaded))?m9("stream progress bytes number invalid"):F+=Number(S.numBytesDownloaded)}return F}return 0},yY7=function(){HJ.apply(this,arguments)},bcz=function(v){u$({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},v)},tm7=function(){HJ.apply(this,arguments)},pW7=function(v,F,c,S){S={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!S};F&&c&&(F=Math.floor(F/1024).toFixed(),c=Math.floor(c/1024).toFixed(),S.alreadyDownloadedKbytes=F,S.totalFetchedKbytes=F,S.totalContentKbytes=c);u$(S,v)},v2O=function(){Mt.apply(this,arguments)},o8=function(v,F,c,S,J){var A,C,P;
return g.M(function(z){if(z.B==1)return g.H(z,a8(),2);A=z.j;if(!A)return z.return([]);C=F.map(function(U){var n=g.DB(U,c);n={actionType:S,entityKey:n,actionMetadata:Object.assign({},Fvt(),J)};S!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(n.actionMetadata.priority=0);U=new TV(c,U,n);return LK(U)});
P=csd(A,C);AYt(v.L);return z.return(P)})},sGj=function(){HJ.apply(this,arguments)},JsZ=function(){var v,F;
return g.M(function(c){if(c.B==1)return g.H(c,g.Lc(),2);if(c.B!=3){v=c.j;if(!v)throw g.x_("rvdfd");return g.H(c,g.G7(v),3)}F=c.j;return c.return(g.Hu(F,["index","media"],{mode:"readwrite",cX:!0},function(S){var J={};return g.cb(S.objectStore("index"),{},function(A){var C=A.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),P=g.zo.resolve(void 0);if(C){var z=C[1];C=C[2];J[z]=J[z]||{};var U;J[z][C]=g.P7a((U=A.getValue())==null?void 0:U.fmts)}else P=A.delete().then(function(){});
return g.zo.all([g.sI(A),P]).then(function(n){return g.k(n).next().value})}).then(function(){for(var A={},C=g.k(Object.keys(J)),P=C.next();!P.done;P=C.next()){P=P.value;
var z=J[P].v;A[P]=J[P].a&&z?1:2}var U=SgI(A);return g.QrJ(S.objectStore("media"),{},function(n){var r=n.cursor.key.match(g.UJb);r&&A[r[1]]||S.objectStore("media").delete(n.cursor.key);return g.uY2(n)}).then(function(){return U})})}))})},AsY=function(){HJ.apply(this,arguments)},eEo=function(v,F){var c,S;
return g.M(function(J){switch(J.B){case 1:return c=Zg(F),g.H(J,jb(v.B,F.entityKey,"transfer"),2);case 2:S=J.j;if(!S||S.transferState!=="TRANSFER_STATE_COMPLETE")return J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.f1(J,3);return g.H(J,CC7(v,F,!0),5);case 5:g.Ek(J,4);break;case 3:return g.Lf(J),J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},zEf=function(v,F,c,S){var J,A,C,P,z,U,n,r,h,Q,u,D,w;
return g.M(function(G){switch(G.B){case 1:c||(c=Date.now().toString());A=(J=F.channel)==null?void 0:J.offlineChannelData;C={id:g.DB(F.videoId,"ytMainChannelEntity"),channelId:A.channelId,title:A.title,avatar:A.thumbnail};P={key:g.DB(F.videoId,"mainVideoDownloadStateEntity"),playbackData:g.DB(F.videoId,"playbackData"),addedTimestampMillis:c,videoDownloadContextEntity:g.DB(F.videoId,"videoDownloadContextEntity")};z={key:g.DB(F.videoId,"videoPlaybackPositionEntity"),videoId:F.videoId,lastPlaybackPositionSeconds:"0"};
v.Y.D("html5_offline_playback_position_sync")&&(U={playbackPosition:z.key});n=g.DB(F.videoId,"mainVideoEntity");r={key:n,videoId:F.videoId,title:F.title,thumbnail:F.thumbnail,localizedStrings:{viewCount:F.shortViewCountText},userState:U,lengthSeconds:F.lengthSeconds?Number(F.lengthSeconds):void 0,publishedTimestampMillis:F.publishedTimestamp?(Number(F.publishedTimestamp)*1E3).toString():void 0,formattedDescription:F.description,owner:C.id,downloadState:P.key};if(!v.Y.D("woffle_enable_main_downloads_library")||
!S){G.A$(2);break}return g.H(G,gJ7(v.B,[n]),3);case 3:if(u=G.j)h=u.mainDownloadsLibraryEntity,Q=u.mainDownloadsListEntity;case 2:return w=PCI,D={key:g.DB(F.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.c1(P,w,D),g.H(G,gX(v.B,{mode:"readwrite",cX:!0},function(O){var a=yX(O,C,"ytMainChannelEntity"),T=yX(O,P,"mainVideoDownloadStateEntity"),m=yX(O,r,"mainVideoEntity");a=[a,T,m];v.Y.D("html5_offline_playback_position_sync")&&(T=yX(O,z,"videoPlaybackPositionEntity"),
a.push(T));h&&(T=yX(O,h,"mainDownloadsLibraryEntity"),a.push(T));Q&&(T=yX(O,Q,"mainDownloadsListEntity"),a.push(T));D&&(O=yX(O,D,"downloadStatusEntity"),a.push(O));return g.zo.all(a)}),4);
case 4:return G.return({mainVideoEntity:r,channelEntity:C})}})},rsr=function(){UBf||(UBf=new n2r);
return UBf},uiZ=function(v,F,c){var S=hEz(F);
c=QG_(c);if(!c)return g.zo.resolve([]);c=new c(F);v=v.B.objectStore("EntityAssociationStore");F=[];c=g.k(c.j());for(var J=c.next();!J.done;J=c.next())F.push(g.zx(v,{parentEntityKey:S,childEntityKey:J.value}));return g.zo.all(F).then(function(A){return A.map(function(C){return C[1]})})},ifO=function(v,F){var c={offlineOrchestrationContext:ahI(v)};
F=NoO(F,c);kpo(rsr(),F,v.rootActionId)},DBo=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O;
return g.M(function(a){switch(a.B){case 1:return c=Zg(F),S=g.Bx(F.entityKey),J=S.entityId,g.H(a,jb(v.B,F.entityKey,"mainVideoEntity"),2);case 2:A=a.j;if(!A){C=void 0;a.A$(3);break}return g.H(a,jb(v.B,A.downloadState,"mainVideoDownloadStateEntity"),4);case 4:C=a.j;case 3:P=C;if(!A||!P)return a.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.f1(a,5);return g.H(a,QZH(v,J,P.addedTimestampMillis,(U=g.x(F.actionMetadata,i$))==null?void 0:U.offlineVideoData),7);case 7:n=1;n=Number(((r=
F.actionMetadata)==null?void 0:r.priority)||0)+1;z=qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"playbackData",n,uRd);g.Ek(a,6);break;case 5:h=g.Lf(a);if(!(h instanceof Error&&h.message==="No data")){if(h instanceof Error&&h.message==="Empty response body")m9(h.message);else return Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.V$&&h.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),a.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,Q,u));a.A$(6);break}return g.H(a,OO(v.B,J),9);case 9:D=a.j;w=g.x(F.actionMetadata,i$);if(O=(G=w)==null?void 0:G.playlistId)D.playlistId=O;D.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.H(a,R8(J,v.B,F,v.L,D),6);case 6:return a.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,z?[z]:void 0))}})},xBH=function(){this.locks=navigator.locks},Bo7=function(v,
F){var c,S,J,A,C,P,z,U,n;
return g.M(function(r){switch(r.B){case 1:return c=F.entityKey,J=(S=g.x(F.actionMetadata,l$))==null?void 0:S.isEnqueuedForExpiredStreamUrlRefetch,g.f1(r,2),A=void 0,g.H(r,Wvd(v,F),4);case 4:A=r.j;g.f1(r,5);var h=(h=g.x(F.actionMetadata,l$))?{maximumDownloadQuality:h.maximumDownloadQuality}:void 0;return g.H(r,Lat(c,v.Y,{isEnqueuedForExpiredStreamUrlRefetch:J,gz:h,offlineSourceData:A}),7);case 7:C=r.j;g.Ek(r,6,2);break;case 5:return g.Lf(r,2),P=Zg(F)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",m9("PDE handleAdd error"),r.return(fK(F,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",P,"DOWNLOAD_STATE_FAILED"));case 6:return g.H(r,wWZ(v,C,F),8);case 8:return r.return(fK(F,!0,C.orchestrationActions));case 2:return z=g.Lf(r),U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.V$&&z.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m9("PDE handleAdd error"),r.return(fK(F,!1,void 0,U,n,"DOWNLOAD_STATE_FAILED"))}})},wd7=function(){HJ.apply(this,arguments)},MA=function(v){v.W&&v.K&&v.V&&v.visibility.isBackground()?g.le(v.C,6E4):v.C.stop()},REj=function(v){var F;
v=(F=v.options)==null?void 0:F.persistenceOption;return v==="ENTITY_PERSISTENCE_OPTION_PERSIST"||v==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},a8=function(){Of7||(Of7=l1I());
return Of7},Pi=function(v,F,c,S,J){J=J===void 0?!1:J;
var A,C,P,z,U,n;return g.M(function(r){if(r.B==1)return A=g.DB(v,F),C=g.DB(v,"downloadStatusEntity"),g.H(r,gX(c,{mode:"readonly",cX:!0},function(h){return g.zo.all([sO(h,A,F),sO(h,C,"downloadStatusEntity")])}),2);
P=r.j;z=P.length?P[0]:void 0;if(!z)return r.A$(0);U=PCI;if(n=P.length>1?P[1]:void 0){if(n.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!J)return r.return();n.downloadState=S}else n={key:C,downloadState:S};g.c1(z,U,n);return g.H(r,gX(c,{mode:"readwrite",cX:!0},function(h){return g.zo.all([yX(h,z,F),yX(h,n,"downloadStatusEntity")])}),0)})},Gpf=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G;
return g.M(function(O){switch(O.B){case 1:return c=Zg(F),S=g.Bx(F.entityKey),J=S.entityId,A=[],g.f1(O,2),g.H(O,ecZ(v,J),4);case 4:A=O.j;if((C=A)==null||!C.length){O.A$(5);break}return g.H(O,YgZ(v.B,F.entityKey),5);case 5:g.Ek(O,3);break;case 2:return P=g.Lf(O),z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.V$&&P.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
O.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,z,U));case 3:return n=[],g.H(O,pA7(v.B,"musicTrack",A),7);case 7:A=O.j;if(A.length)for(r=g.k(A),h=r.next();!h.done;h=r.next())if(Q=h.value,u=Q.offlineVideoData,D=void 0,(D=u)==null?0:D.videoId)w=void 0,G=Number(((w=F.actionMetadata)==null?void 0:w.priority)||0)+1,n.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",u.videoId,"musicTrack",G,kT,ci(F,u,J)));return O.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,n))}})},
E2Y=function(v,F){var c,S,J,A,C,P;
return g.M(function(z){switch(z.B){case 1:c=new Map,S=g.k(F),J=S.next();case 2:if(J.done){z.A$(4);break}A=J.value;C=c;P=C.set;return g.H(z,v.j(A),5);case 5:P.call(C,A,z.j);J=S.next();z.A$(2);break;case 4:return z.return(c)}})},a1Y=function(v,F){var c,S,J,A;
return g.M(function(C){if(C.B==1){c=F.clientPlaybackNonce;S={cpn:c,offlineSourceVisualElement:g.aE(F.Mk||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};F.j&&(S.videoFmt=Number(F.j.itag));F.C&&(S.audioFmt=Number(F.C.itag));if((J=dBH(F))&&F.videoId){var P=F.videoId;P=J!=="PPSV"?Promise.resolve(!1):v.B.qZ(P);C=g.H(C,P,3)}else C=C.A$(2);return C}C.B!=2&&(A=C.j)&&(S.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");v.j=c;g.wo("offlinePlaybackStarted",S);g.jo(C)})},o2Z=function(v,
F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ;
return g.M(function(xW){switch(xW.B){case 1:return c=Zg(F),S=[],g.H(xW,Hi.getInstance(),2);case 2:J=xW.j;if(!J){xW.A$(3);break}return g.H(xW,J.get("sdois"),4);case 4:return A=xW.j,g.H(xW,(P=J)==null?void 0:P.get("lmqf"),5);case 5:C=xW.j;case 3:g.f1(xW,6);if(A===void 0)throw Error("prefStorage or opt-in state is undefined");z=[];if(A){xW.A$(8);break}return g.H(xW,MH_(v.B),9);case 9:z=xW.j,z.reverse();case 8:if(!z.length){xW.A$(10);break}U=g.k(z);n=U.next();case 11:if(n.done){xW.A$(10);break}r=n.value;
if(!r){xW.A$(12);break}h=g.Bx(r).entityId;return g.H(xW,OO(v.B,h),14);case 14:return Q=xW.j,Q.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.H(xW,R8(h,v.B,{entityKey:r,actionType:F.actionType},v.L,Q),12);case 12:n=U.next();xW.A$(11);break;case 10:return g.H(xW,KS7(A,(u=C)!=null?u:"SD"),16);case 16:return D=xW.j,g.H(xW,hPZ(D),17);case 17:w=Toj(D);if(!v.Y.D("woffle_enable_main_downloads_library")){xW.A$(18);break}if(A){xW.A$(19);break}return g.H(xW,qIr(v.B,g.Mn),19);case 19:return g.H(xW,
tHH(v.B,[g.Mn]),18);case 18:if((G=w)==null?0:G.length)for(O=g.k(w),a=O.next();!a.done;a=O.next())if(m=T=a.value,b=m.actionType,X=m.entityKey,AJ=m.actionMetadata,b&&X&&AJ&&!g.x(AJ,Lv7)){b==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(AJ.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(C1=g.x(T.actionMetadata,i$))C1.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",T.actionMetadata=Object.assign({},T.actionMetadata,{mainVideoEntityActionMetadata:C1});S.push(T)}g.Ek(xW,
7);break;case 6:return c3=g.Lf(xW),n1="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",FJ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c3 instanceof g.V$&&c3.type==="QUOTA_EXCEEDED"&&(n1="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",FJ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),xW.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,n1,FJ));case 7:return xW.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,S))}})},f1z=function(v,F,c,S){S=
S===void 0?[]:S;
F={offlineOrchestrationContext:ahI(v,F,c,S)};F=NoO(3,F);kpo(rsr(),F,v.rootActionId)},M4z=function(){HJ.apply(this,arguments)},u$=function(v,F){var c=F.videoId;
var S=F.ZG;F=F.offlineModeType;v.encryptedVideoId=c;v.cotn=S==null?void 0:S.cotn;v.offlineabilityFormatType=S==null?void 0:S.maximumDownloadQuality;var J;v.isRefresh=(J=S==null?void 0:S.isRefresh)!=null?J:!1;var A;v.softErrorCount=(A=S==null?void 0:S.transferRetryCount)!=null?A:0;v.offlineModeType=F!=null?F:"OFFLINE_NOW";(v.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&v.statusType==="UNKNOWN_STATUS_TYPE"||!v.transferStatusType&&!v.statusType)&&g.Hz(Error("Woffle unknown transfer status"));
g.wo("offlineTransferStatusChanged",v)},CK=function(v){var F,c;
return g.M(function(S){if(S.B==1)return g.H(S,Hft(),2);if(S.B!=3){F=S.j;if(!F)throw Error("Cache API not supported");return v.length?g.H(S,F.open("yt-player-local-img"),3):S.return()}c=S.j;return g.H(S,c.addAll(v),0)})},V4o=function(){var v;
return g.M(function(F){return F.B==1?g.H(F,Hft(),2):(v=F.j)?F.return(v.delete("yt-player-local-img")):F.return(!0)})},jG_=function(){HJ.apply(this,arguments)},mBf=function(){HJ.apply(this,arguments)},$Bj=function(){HJ.apply(this,arguments)},XdI=function(v){return{context:g.dk(),
videoIds:v}},Qx=function(v,F){var c,S,J;
return g.M(function(A){if(A.B==1)return g.H(A,jb(v.j,g.DB(F,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);c=A.j;return A.return((J=(S=c)==null?void 0:S.offlineModeType)!=null?J:void 0)})},Zfr=function(v,F){var c;
return((c=v.player)==null?void 0:c.getVideoData().videoId)===F?v.player:null},Kvt=function(){HJ.apply(this,arguments)},QG_=function(v){var F=qgr[v];
if(F)return F;g.Hz(new g.VS("Entity model not found.",{entityType:v}))},I1j=function(){HJ.apply(this,arguments)},yst=function(v,F){var c=g2Z[v.transferState],S=g2Z[F.transferState];
return c!==S?c-S:Number(v.enqueuedTimestampMs)-Number(F.enqueuedTimestampMs)},SgI=function(v){var F=g.Pn();
F=Object.assign({},F);v=Object.assign({},v);for(var c in F)v[c]?(F[c]!==4&&(F[c]=v[c]),delete v[c]):F[c]!==2&&(F[c]=4);Object.assign(F,v);g.Iu5(F);JSON.stringify(F);return F},t47=function(v,F,c){F=bft(v.Y,c.cotn,F);
c=g.xQ(F);return g.Mh5(F,c,v.Y)},pdr=function(v){if(v.includes(":"))throw Error("Invalid user cache name: "+v);
return v+":"+g.tb("CacheStorage get")},CC7=function(v,F,c){c=c===void 0?!1:c;
var S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G;return g.M(function(O){switch(O.B){case 1:return S=g.x(F.actionMetadata,vS7),J=g.Bx(F.entityKey).entityId,A=g.DB(J,"downloadStatusEntity"),g.H(O,gX(v.B,{mode:"readonly",cX:!0},function(a){var T=sO(a,A,"downloadStatusEntity");a=sO(a,g.DB(J,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.zo.all([T,a])}),2);
case 2:return C=O.j,P=g.k(C),z=P.next().value,U=P.next().value,n=z,r=U,h="TRANSFER_STATE_TRANSFER_IN_QUEUE",((Q=n)==null?void 0:Q.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(h="TRANSFER_STATE_PAUSED_BY_USER"),w={key:F.entityKey,transferState:h,cotn:g.gg(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(u=S)==null?void 0:u.maximumDownloadQuality,preferredAudioTrack:(D=S)==null?void 0:D.preferredAudioTrack,transferRetryCount:0,isRefresh:c,hasLoggedFirstStarted:!1},g.H(O,gX(v.B,
{mode:"readwrite",cX:!0},function(a){var T=[];c&&T.push(nK(a,g.DB(J,"offlineVideoStreams")));T.push(yX(a,w,"transfer"));return g.zo.all(T)}),3);
case 3:if(!c){O.A$(4);break}return g.H(O,F2_(J),4);case 4:bcz({videoId:J,ZG:w,offlineModeType:(G=r)==null?void 0:G.offlineModeType}),g.jo(O)}})},ssO=function(v,F){var c,S,J,A;
return g.M(function(C){c=F.videoId;S=!0;if(F.captionTracks.length)J=c0f(F),v.B=new g.bX(v.Eb,F,J);else if(F.pB)A=g.O77(F),v.B=new g.F9(v.Eb,F.pB,c,A,F.l4,F.eventId),S=F.l4;else return C.return();return C.return(new Promise(function(P){var z;(z=v.B)==null||z.pM({Gh:function(){return g.M(function(U){if(U.B==1)return g.H(U,v.Gh(c,S),2);P();g.jo(U)})},
DT:function(){}})}))})},qt=function(v,F,c,S,J,A){F=g.DB(F,c);
S=Object.assign({},A,{priority:S,retryScheduleIntervalsInSeconds:J});return{actionType:v,entityKey:F,actionMetadata:S}},Z3j=function(v,F,c,S){var J,A,C,P,z,U,n,r,h;
return g.M(function(Q){if(Q.B==1)return J=g.DB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),A=new Map,g.H(Q,gX(v,{mode:"readwrite",cX:!0},function(u){var D=e2(u,"transfer"),w=e2(u,"offlineOrchestrationActionWrapperEntity"),G=e2(u,"videoDownloadContextEntity"),O=sO(u,J,"mainDownloadsListEntity");return g.zo.all([D,w,G,O]).then(function(a){a=g.k(a);var T=a.next().value;var m=a.next().value;var b=a.next().value;var X=a.next().value;a=SBI.map(function(C1){return J0O(u,C1)});
m=g.k(m);for(var AJ=m.next();!AJ.done;AJ=m.next())AJ=AJ.value,Wi(F,AJ.actionProto)||a.push(nK(u,AJ.key,{nx:!0}));X&&(X.downloads=[],a.push(yX(u,X,"mainDownloadsListEntity")));if(b)for(b=g.k(b),X=b.next();!X.done;X=b.next())X=X.value,m=g.Bx(X.key).entityId,m=g.DB(m,"transfer"),A.set(m,X.offlineModeType);return g.zo.all(a).then(function(){return T})})}),2);
C=Q.j;P=g.k(C);for(z=P.next();!z.done;z=P.next())U=z.value,w0(U,A.get(U.key)),n=g.Bx(U.key).entityId,r={videoId:n,offlineDeleteReason:S,cotn:U.cotn,offlineModeType:A.get(U.key)},Bi(r),h=g.DB(n,"mainVideoEntity"),hq(c,{entityKey:h,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.H(Q,V4o(),0)})},A0Z=function(v){switch(v.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},CcH=function(v,F){v.B&&(v.K=F,MA(v))},e_r=function(){HJ.apply(this,arguments)},Wi=function(v,F){return v.actionType===F.actionType&&v.entityKey===F.entityKey},Ocf=function(v,F){a:{v=vld(v.j,F.version);
try{var c=v.j(F.data,F.key);break a}catch(S){Pcd(S,AUI)}c=void 0}return c},sO=function(v,F,c){return v.B.objectStore("EntityStore").get(F).then(function(S){if(S){if(c&&S.entityType!==c)throw Error("Incorrect entity type");
return Ocf(v,S)}})},TV=function(v,F,c,S,J,A,C,P,z,U,n){this.entityType=v;
this.actionId=F;this.action=c;this.parentActionId=S;this.rootActionId=J===void 0?F:J;this.childActionIds=A;this.prereqActionId=C;this.postreqActionIds=P;this.hasChildActionFailed=U;this.retryScheduleIndex=0;this.B=n||Date.now();this.retryScheduleIndex=z||0},qyZ=function(v){var F;
return g.M(function(c){return c.B==1?g.H(c,a8(),2):(F=c.j)?g.H(c,gX(F,"readwrite",function(S){for(var J={},A=g.k(v),C=A.next(),P={};!C.done;P={KL:void 0,bJ:void 0},C=A.next())P.KL=C.value,P.KL.entityKey&&REj(P.KL)&&(P.bJ=g.Tg(P.KL.payload),C=void 0,P.KL.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(C=function(z){return function(){return yX(S,z.KL.payload[z.bJ],z.bJ)}}(P)),P.KL.type==="ENTITY_MUTATION_TYPE_DELETE"&&(C=function(z){return function(){return nK(S,z.KL.entityKey)}}(P)),P.KL.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(C=function(z){return function(){return sZt(S,z.KL.entityKey,z.KL.payload[z.bJ],z.bJ)}}(P)),C&&(J[P.KL.entityKey]=J[P.KL.entityKey]?J[P.KL.entityKey].then(C):C()));
return g.zo.all(Object.values(J))}),0):c.return()})},dxo=function(v,F){return v!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||F?v==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&F?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":v:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},z_7=function(){HJ.apply(this,arguments)},UaH=function(v){var F,c,S;
return g.M(function(J){if(J.B==1){if(!v.B)return zV(v,"onTransferStart"),J.return();v.C.start(108E5);return g.H(J,UO(v,"TRANSFER_STATE_TRANSFERRING"),2)}F=v.B;return(S=((c=F)==null?0:c.key)?g.Bx(F.key).entityId:"")&&v.L?g.H(J,Pi(S,v.L,v.j,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):J.A$(0)})},nSd=function(){HJ.apply(this,arguments)},x5d=function(v){var F,c,S,J,A,C,P,z;
return g.M(function(U){switch(U.B){case 1:return F=g.S6(),c=XdI(v),S=g.Es(qnj),g.f1(U,2),A={Rk:!0},g.H(U,g.dj(F,c,S,void 0,A),4);case 4:J=U.j;g.Ek(U,3);break;case 2:C=g.Lf(U);if(C instanceof g.iR)throw P="GetOffline network manager error: "+C.message,m9(P,C),Error(P);m9("GetOffline fetch request error",C);throw Error("GetOffline fetch request error");case 3:z=$H(J);if(!J)throw m9("Network request failed"),Error("Network request failed");if(z!==void 0)Xr(z);else if(!J.videos||!J.videos.length)throw m9("No data"),
Error("No data");return U.return(J.videos.map(function(n){return n.offlineVideoData}))}})},r0I=function(){NA.apply(this,arguments);
this.bX="mainVideoEntity"},h_t=function(){HJ.apply(this,arguments)},Qsz=function(v,F){var c,S;
return g.M(function(J){switch(J.B){case 1:return c=Zg(F),g.H(J,jb(v.B,F.entityKey,"transfer"),2);case 2:if(S=J.j)return J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.f1(J,3);return g.H(J,CC7(v,F),5);case 5:g.Ek(J,4);break;case 3:return g.Lf(J),J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},uaY=function(){HJ.apply(this,arguments)},Nsf=function(v){v=(new TextEncoder).encode(v).subarray(0,16);
var F=new Uint8Array(16);F.set(v);return F},k3d=function(v,F){this.B=v;
this.Y=F},bMd=function(v,F,c,S){var J,A,C,P,z,U,n;
return g.M(function(r){switch(r.B){case 1:return g.H(r,IKI([F]),2);case 2:return J=r.j,g.H(r,iwz(v,J[0],c,S),3);case 3:return A=r.j,C=A.mainPlaylistEntity,P=A.D1y,U=$xH(C,(z=P)==null?void 0:z.avatar),g.f1(r,4),g.H(r,CK(U),6);case 6:g.Ek(r,5);break;case 4:n=g.Lf(r),n instanceof Error&&n.message==="Failed to fetch"&&m9(n.message);case 5:return r.return(J[0].videos)}})},xaj=function(v){var F,c;
return g.M(function(S){if(S.B==1)return g.H(S,tC(v.j,"transfer"),2);F=S.j;c=F.filter(Dad).sort(yst);return c.length===0?S.return():S.return(c[0])})},Syd=function(v,F,c){var S=this;
this.G=v;this.bX=F;this.visibility=c;this.V=this.W=this.K=this.L=this.B=!1;this.C=new g.W6(function(){S.Cp()});
this.gZ={cO:function(){return S.j},
Cp:function(){S.Cp()},
KFS:function(){return S.C}};
this.visibility.subscribe("visibilitystatechange",function(){S.DM()})},Bs7=function(v,F,c){F=F===void 0?43200:F;
c=c===void 0?!0:c;var S=S===void 0?!1:S;var J,A;return g.M(function(C){switch(C.B){case 1:if(!v.K.xU())return C.return([]);J=[];g.f1(C,2);return g.H(C,ePo(F,c,S),4);case 4:J=C.j;g.Ek(C,3);break;case 2:g.Lf(C);case 3:return A=W2r(v,J,c,"musicPlaylist"),C.return(A)}})},wzd=function(v){u$({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},v)},R_7=function(){return g.M(function(v){if(Vx!==void 0)return v.return(Vx);
Vx=new Promise(function(F){var c;return g.M(function(S){switch(S.B){case 1:return g.f1(S,2),g.H(S,j2.open("test-only"),4);case 4:return g.H(S,j2.delete("test-only"),5);case 5:g.Ek(S,3);break;case 2:if(c=g.Lf(S),c instanceof Error&&c.name==="SecurityError")return F(!1),S.return();case 3:F("caches"in window),g.jo(S)}})});
return v.return(Vx)})},Bi=function(v){var F;
v.offlineDeleteReason=(F=v.offlineDeleteReason)!=null?F:"OFFLINE_DELETE_REASON_UNKNOWN";var c;v.offlineModeType=(c=v.offlineModeType)!=null?c:"OFFLINE_NOW";g.wo("offlineDeleteEvent",v)},m5=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!v.entityKey},Owd=function(v){var F=[],c=v.videos;
c&&c.length>0&&F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:c[0].offlineVideoData.thumbnail}}});if((v=v.additionalMetadadatas)&&v.length>0)for(v=g.k(v),c=v.next();!c.done;c=v.next()){var S=c.value.offlineBundleItemPlaylistData,J=void 0;c=(J=S)==null?void 0:J.style;J=void 0;S={collageThumbnail:{coverThumbnail:(J=S)==null?void 0:J.coverThumbnail}};switch(c){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:S});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:S});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:S});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:S})}}return F},l5Y=function(v,F){var c,S,J;
return g.M(function(A){switch(A.B){case 1:return g.f1(A,2),g.H(A,KS7(v,F),4);case 4:return S=A.j,g.H(A,hPZ(S),5);case 5:c=Toj(S);g.Ek(A,3);break;case 2:J=g.Lf(A),m9("getAndProcessSmartDownloadsResponse request or processing error",J);case 3:return A.return(c)}})},YBo=function(v){var F,c,S;
return g.M(function(J){if(J.B==1)return F=IDBKeyRange.bound(v+"|",v+"~"),g.H(J,g.Lc(),2);if(J.B!=3){c=J.j;if(!c)throw g.x_("gactfv");return g.H(J,g.G7(c),3)}S=J.j;return J.return(S.getAll("captions",F))})},da7=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6,dO,p7,Y,H_,PQ,yZ,ea,aO,B,p,R1,zh,fN,rL,v_,sr,Ej,R,W,l,L,I,P3,K,sa,f,Oa,L1,Dd,Ea,Vt,YW,I1,Fu,sj,a5,pU,o5,lt,XJ,Gi,YI;
return g.M(function(vQ){switch(vQ.B){case 1:return c=Zg(F),S=F.entityKey,J=g.Bx(S).entityId,A=[],C=!1,J==="!*$_ALL_ENTITIES_!*$"?(C=!0,g.H(vQ,tC(v.B,"mainPlaylistEntity"),5)):g.H(vQ,jb(v.B,S,"mainPlaylistEntity"),4);case 4:(P=vQ.j)&&A.push(P);vQ.A$(3);break;case 5:A=vQ.j;case 3:if((z=A)==null||!z.length)return vQ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));U=g.x(F.actionMetadata,G3O);r=(n=U)==null?void 0:n.nextAutoRefreshIntervalSeconds;Q=(h=U)==null?void 0:h.autoSync;u=[];w=D=
!0;G=!1;if(!C&&Q===!1){vQ.A$(6);break}g.f1(vQ,7);return g.H(vQ,ESZ(0,!!Q,!0,A),9);case 9:u=vQ.j;g.Ek(vQ,8);break;case 7:O=g.Lf(vQ);if(!(O instanceof Error&&O.message==="No data")){O instanceof Error&&O.message==="Empty response body"&&m9(O.message);vQ.A$(8);break}return J==="!*$_ALL_ENTITIES_!*$"?g.H(vQ,Z3j(v.B,F,v.L,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.H(vQ,KaI(J,v.B,F,v.L),8);case 8:if(!u.length||!C&&u[0].playlistId!==J)return vQ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));case 6:if(C){a=[];T=g.k(u);for(m=T.next();!m.done;m=T.next())b=m.value,b.upToDate||Q&&!b.shouldAutoSyncMetadata||!b.playlistId||(X={nextAutoRefreshIntervalSeconds:b.checkInSeconds,autoSync:Q},a.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b.playlistId,"mainPlaylistEntity",0,Ix,{mainPlaylistEntityActionMetadata:X})));return vQ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,a))}u.length&&(AJ=u[0],G=!!AJ.upToDate,Q&&(D=(C1=AJ.shouldAutoSyncMetadata)!=null?C1:!0,w=(c3=AJ.shouldAutoSyncVideos)!=
null?c3:!0,AJ.checkInSeconds&&(r=AJ.checkInSeconds)));if(G||!D)return vQ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));n1=[];FJ=A[0];if(!FJ.downloadState){xW=void 0;vQ.A$(15);break}return g.H(vQ,jb(v.B,FJ.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:xW=vQ.j;case 15:return tJ=xW,eY=((zf=tJ)==null?0:zf.addedTimestampMillis)?String(tJ.addedTimestampMillis):void 0,g.f1(vQ,17),g.H(vQ,bMd(v,J,eY,r),19);case 19:n1=vQ.j;g.Ek(vQ,18);break;case 17:T6=g.Lf(vQ);if(!(T6 instanceof
Error&&T6.message==="No data for playlist")){if(T6 instanceof Error&&T6.message==="Empty response body for playlist")m9(T6.message);else return dO="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p7="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T6 instanceof g.V$&&T6.type==="QUOTA_EXCEEDED"&&(dO="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",p7="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),vQ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,dO,p7));
vQ.A$(18);break}return g.H(vQ,KaI(J,v.B,F,v.L),18);case 18:if(!w)return vQ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));Y=[];H_=new Map;if((PQ=n1)==null?0:PQ.length)for(yZ=g.k(n1),ea=yZ.next();!ea.done;ea=yZ.next())aO=ea.value,B=aO.offlineVideoData,p=void 0,((p=B)==null?0:p.videoId)&&H_.set(B.videoId,B);R1=new Map;zh=[];if((fN=FJ)==null?0:(rL=fN.videos)==null?0:rL.length)for(v_=g.k(FJ.videos),sr=v_.next();!sr.done;sr=v_.next())if(Ej=sr.value,R=JSON.parse(g.Bx(Ej).entityId),W=R.videoId)H_.has(W)?
(R1.set(W,H_.get(W)),H_.delete(W)):zh.push(W);L=Number(((l=F.actionMetadata)==null?void 0:l.priority)||0)+1;I=g.k(H_.entries());for(P3=I.next();!P3.done;P3=I.next())K=P3.value,sa=g.k(K),f=sa.next().value,Oa=sa.next().value,L1=f,Dd=Oa,Y.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",L1,"mainVideoEntity",L,Ix,vJO(F,Dd,J)));Ea=g.k(R1.entries());for(Vt=Ea.next();!Vt.done;Vt=Ea.next())YW=Vt.value,I1=g.k(YW),Fu=I1.next().value,sj=I1.next().value,a5=Fu,pU=sj,Y.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
a5,"mainVideoEntity",L,Ix,vJO(F,pU,J)));o5=g.k(zh);for(lt=o5.next();!lt.done;lt=o5.next())XJ=lt.value,Gi={playlistId:J},YI={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Gi},Y.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",XJ,"mainVideoEntity",0,Ix,YI));return vQ.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,Y))}})},a5d=function(v){var F,c,S;
g.M(function(J){if(J.B==1){if(!v.B)return zV(v,"onTransferPausedByNetwork"),J.return();v.C.stop();return g.H(J,UO(v,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(J.B!=3)return F=v.B,(S=((c=F)==null?0:c.key)?g.Bx(F.key).entityId:"")&&v.L?g.H(J,Pi(S,v.L,v.j,"DOWNLOAD_STATE_PAUSED"),3):J.A$(3);d0(v);g.jo(J)})},Ts7=function(){HJ.apply(this,arguments)},oSH=function(v,F){var c,S,J,A,C,P,z,U;
return g.M(function(n){switch(n.B){case 1:return c=g.S6(),S={context:g.dk(),videoPlaybackPositionEntities:v,lastSyncTimestampUsec:F},J=g.Es(L27),g.f1(n,2),C={Rk:!0},g.H(n,g.dj(c,S,J,void 0,C),4);case 4:A=n.j;g.Ek(n,3);break;case 2:P=g.Lf(n);if(P instanceof g.iR)throw z="VPPS network manager error: "+P.message,m9(z,P),Error(z);m9("VPPS fetch request error",P);throw Error("VPPS fetch request error");case 3:U=$H(A);if(A)U!==void 0&&Xr(U,"position sync");else throw m9("Network request failed for position sync"),
Error("Network request failed for position sync");return n.return(A)}})},Hi=function(v){this.token=v},f5t=function(){try{var v=g.P_("ytglobal.locks_");
if(v)return v;var F;if(F=navigator){var c=navigator;F="locks"in c&&!!c.locks}if(F)return g.C7.localStorage&&g.C7.localStorage.getItem("noop"),v=new xBH,g.J0("ytglobal.locks_",v),v}catch(S){}},$T=function(v){g.q.call(this);
this.B=v;this.j=this.B.observe(this.L.bind(this))},Hwf=function(v,F){var c,S,J,A,C,P,z;
return g.M(function(U){switch(U.B){case 1:if(F.length===0)return U.return([]);c=F.map(function(n){return g.DB(n,"transfer")});
return g.H(U,tC(v.B,"transfer",c),2);case 2:S=U.j;J=S.filter(Mt7).map(function(n){return g.Bx(n.key).entityId});
A=F.filter(function(n){return J.indexOf(n)===-1});
if(A.length===0)return U.return([]);C=g.k(A);P=C.next();case 3:if(P.done){U.A$(5);break}z=P.value;return g.H(U,F2_(z),4);case 4:P=C.next();U.A$(3);break;case 5:return U.return(A)}})},hEz=function(v){v=v.key||v.id;
if(!v)throw Error("Entity key is missing");return v},Hft=function(){return g.M(function(v){if(v.B==1)return g.H(v,R_7(),2);
if(!v.j)return v.return(void 0);Vto||(Vto=new BnI);return v.return(Vto)})},Kpj=function(v){return{context:g.dk(),
playlistIds:v}},JYf=function(v){return g.M(function(F){v.api.rS("onOrchestrationBecameLeader");
return g.H(F,v.jd(),0)})},js_=function(v,F){this.api=v;
this.B=F;this.logger=new g.ye("woffle");this.j=!1;this.gZ={aG:this.aG}},hq=function(v,F){v.api.rS("onOfflineOperationFailure",F);
var c;(c=v.B)==null||c.postMessage(F)},Wvd=function(v,F){var c,S,J,A;
return g.M(function(C){if(C.B==1)return c=g.Bx(F.entityKey).entityId,S=g.DB(c,"videoDownloadContextEntity"),g.H(C,jb(v.B,S,"videoDownloadContextEntity"),2);J=C.j;return(A=J)!=null&&A.offlineModeType?C.return({offlineModeType:J.offlineModeType}):C.return(void 0)})},maY=function(){HJ.apply(this,arguments)},K_=function(v,F,c,S,J,A){this.status=v;
this.B=F;this.C=c;this.j=S;this.L=J;this.downloadState=A},Zwf=function(v,F){var c,S,J,A,C,P;
return g.M(function(z){switch(z.B){case 1:if(v.G)return z.return();v.G=!0;v.B=F;c=g.Bx(v.B.key);S=c.entityId;J=void 0;if(v.B.transferState==="TRANSFER_STATE_TRANSFERRING")return g.H(z,Qx(v,S),7);if(v.B.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||v.B.transferRetryCount||v.B.hasLoggedFirstStarted){z.A$(3);break}return g.H(z,Qx(v,S),5);case 5:return J=z.j,v.B.hasLoggedFirstStarted=!0,g.H(z,JU7(v),6);case 6:pW7({videoId:S,ZG:v.B,offlineModeType:J},void 0,void 0,!0);z.A$(3);break;case 7:J=z.j,
u$({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:S,ZG:v.B,offlineModeType:J});case 3:return g.H(z,UaH(v),8);case 8:return A=null,g.f1(z,9),g.H(z,D5Y(v,F),11);case 11:A=z.j;v.V=A;g.Ek(z,10);break;case 9:return C=g.Lf(z),m9("error getting player response",C,F.cotn),g.H(z,v.mN("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return z.return();case 10:return P=bft(v.api.S(),F.cotn,A),g.H(z,$ad(v,P),13);case 13:return g.H(z,XzH(P.videoId),
14);case 14:P.Qh=z.j;var U=v.W,n=P,r=F.maximumDownloadQuality;n.getPlayerResponse();g.L6(n.videoId,2);U.L=2;U.j=!1;var h;(h=U.player)==null||h.dispose();U.player=U.api.O6(n);n={};U.player.rX((n.localmediachange=U.G8,n.signatureexpired=U.yf,n.statechange=U.imS,n),U);U.D("html5_generate_content_po_token")&&U.player.c8();r=U.aG(r);U.player.Xn(g.Ic(r,r,!0,"m"),!1);U.player.WJ(!1);v.C.start(108E5);g.jo(z)}})},K2Y=function(v,F){var c;
return g.M(function(S){if(S.B==1)return g.H(S,tC(v.j,"offlineOrchestrationActionWrapperEntity",F),2);c=S.j;return S.return(c.filter(Mt7))})},qBj=function(){HJ.apply(this,arguments)},I5I=function(){HJ.apply(this,arguments)},gSr=function(){this.B={};
this.B[0]=new X8;if(!g.$y("aes_pes_encoder_killswitch")){var v=this.B;try{var F=g.tb();var c=Nsf(F);var S=new EO(new g.hs(c),new g.kx(c))}catch(J){throw v=J instanceof Error?new bH("KEY_CREATION_FAILED",{originalMessage:J.message}):new bH("KEY_CREATION_FAILED"),g.fM(v),v;}v[1]=S}},y0H=function(){HJ.apply(this,arguments)},bwO=function(v,F){var c,S,J,A,C,P,z,U;
return g.M(function(n){c=Aq(v.thumbnailDetails);S=g.k(F);for(J=S.next();!J.done;J=S.next())if(A=J.value,A.id!==v.id)for(C=g.k(Aq(A.thumbnailDetails)),P=C.next();!P.done;P=C.next())z=P.value,U=c.indexOf(z),U!==-1&&c.splice(U,1);return n.return(c)})},yX=function(v,F,c){var S=hEz(F),J=vld(v.j,1),A=Object.assign({},F);
return v.B.objectStore("EntityStore").get(S).then(function(C){if(C){if(C.entityType!==c)throw Error("Incorrect entity type");A.entityMetadata||(C=Ocf(v,C),A.entityMetadata=C.entityMetadata)}}).then(function(){var C={key:S,
entityType:c,data:FSI(J,A,S),version:1};return g.zo.all([g.zx(v.B.objectStore("EntityStore"),C),cYo(v,A,c)])}).then(function(){r0(v,S,c);
return S})},Mt7=function(v){return v!==void 0},ttr=function(){HJ.apply(this,arguments)},pzH=function(){HJ.apply(this,arguments)},vzt=function(){HJ.apply(this,arguments)},cUf=function(v){return gX(v,{mode:"readwrite",
cX:!0},function(F){return J0O(F,"videoPlaybackPositionEntity")})},F2_=function(v){return g.M(function(F){return F.return(F_Y(v))})},cSI=function(){HJ.apply(this,arguments)},ASt=function(v){var F,c;
return g.M(function(S){if(S.B==1)return g.H(S,a8(),2);if(S.B!=3){F=S.j;if(!F)return m9("PES is undefined"),S.return();v.j=new sWf(F,v.api,v.L,v.B);c=v.W9(F);return g.H(S,Sl7(F,c,v.L,v.B,v.Y),3)}v.W=S.j;return g.H(S,JSd(v),0)})},Cp7=function(){HJ.apply(this,arguments)},ebd=function(){var v,F,c,S,J;
return g.M(function(A){if(A.B==1)return g.H(A,a8(),2);if(A.B!=3)return(v=A.j)?g.H(A,tC(v,"refresh"),3):A.return(!1);F=A.j;if((c=F[0])==null||!c.refreshTime)return A.return(!1);S=Number(F[0].refreshTime);J=Date.now()/1E3;return A.return(isFinite(S)&&J>=S)})},Pp7=function(){Mt.apply(this,arguments)},zbd=function(){HJ.apply(this,arguments)},nzf=function(v,F){var c,S,J;
return g.M(function(A){c=g.k(F);for(S=c.next();!S.done;S=c.next()){J=S.value;var C=void 0,P=void 0,z=((P=J.action)==null?void 0:(C=P.actionMetadata)==null?void 0:C.retryScheduleIntervalsInSeconds)||[1,2,4];C=1;J.retryScheduleIndex<z.length&&(C=z[J.retryScheduleIndex]);J.B=C*1E3+Date.now();J.retryScheduleIndex++}return g.H(A,U2o(v,F),0)})},rSH=function(v,F){var c,S,J,A,C,P,z,U,n,r,h;
return g.M(function(Q){if(Q.B==1)return c=[],g.H(Q,gX(v.B,{mode:"readonly",cX:!0},function(u){var D=[],w=F.offlineVideoStreams;if(w){w=g.k(w);for(var G=w.next();!G.done;G=w.next())D.push(sO(u,G.value,"offlineVideoStreams"))}return g.zo.all(D)}),2);
if(S=Q.j)for(J=g.k(S),A=J.next();!A.done;A=J.next())if(C=A.value,P=void 0,(P=C)==null?0:P.streamsProgress)for(z=C.streamsProgress,U=0;U<z.length;U++)n=z[U],r=JSON.parse(n.formatStreamBytes),h={itag:r.itag,lmt:r.lastModified,xtags:r.xtags},c.push(h);return Q.return(c)})},ZA=function(v,F){g.q.call(this);
this.token=v;this.B=F;this.observers=[];v=new g.C7.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.tb());v.onmessage=this.j.bind(this);this.channel=v},hbZ=function(){g.Rv.apply(this,arguments);
var v=this;this.events=new g.KJ(this);this.Y=this.player.S();this.gZ={CW$:function(){return v.B},
m7:function(){return v.m7()},
R6:function(F){return v.R6(F)}}},QW7=function(v){return v instanceof Error?new bH("UNKNOWN_ENCODE_ERROR",{originalMessage:v.message}):new bH("UNKNOWN_ENCODE_ERROR")},uWd=function(v){var F;
return g.M(function(c){if(c.B==1)return g.H(c,YBo(v),2);F=c.j;return c.return(!!F&&F.length>0)})},Ny7=function(v,F,c){this.B=v;
this.Y=F;this.L=c},F_Y=function(v){return g.M(function(F){g.L6(v,0);
return F.return(WSO(v))})},kr_=function(){HJ.apply(this,arguments)},W_O=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q;
return g.M(function(u){c=[];S=Infinity;J=4E3;A=g.k(F);for(C=A.next();!C.done;C=A.next())P=C.value,z=Number(P.enqueueTimeSec),U=iQI(z),n=P.retryScheduleIndex,r=n!=null&&n>0,U>0&&r?(S=Math.min(S,z),J=Math.min(U,J)):c.push(P);isFinite(S)&&(!v.L.isActive()||S<v.G)&&(v.G=S,v.L.start(J));v.K.xU()||(h=c.length,c=c.filter(function(D){var w;D=((w=D.actionProto)==null?void 0:w.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!D2_.includes(D)}),Q=c.length<h,!v.L.isActive()&&Q&&v.L.start(1));
c.length>0&&x2r(v,c);return g.H(u,LS7(v),0)})},Byj=function(){HJ.apply(this,arguments)},wrz=function(v,F){v.B&&(v.W=F,MA(v))},$xH=function(v,F){var c=[];
if(v.thumbnailStyleData){v=g.k(v.thumbnailStyleData);for(var S=v.next();!S.done;S=v.next()){var J=void 0,A=void 0,C=void 0;c=c.concat(Aq((J=S.value)==null?void 0:(A=J.value)==null?void 0:(C=A.collageThumbnail)==null?void 0:C.coverThumbnail))}}F=Aq(F);return c.concat(F)},KK=function(v,F,c,S,J){g.q.call(this);
var A=this;this.j=v;this.py=F;this.Bz=c;this.W=S;this.Y=J;this.B=new jZZ;this.K=new g.y6;this.L=new g.W6(function(){A.retry()});
this.G=NaN;this.V=!1;this.gZ={Ij$:function(){return A.B},
Iq:function(){return A.K},
WFH:function(){return A.L},
retry:function(){return A.retry()}};
g.V(this,this.L);this.bX=this.j.observe(this.Mk.bind(this))},lLH=function(v){var F,c,S,J,A,C,P,z;
return g.M(function(U){switch(U.B){case 1:return F=g.S6(),c=Rbt(v),S=g.Es(OQO),g.f1(U,2),A={Rk:!0},g.H(U,g.dj(F,c,S,void 0,A),4);case 4:J=U.j;g.Ek(U,3);break;case 2:C=g.Lf(U);if(C instanceof g.iR)throw P="offlinePlaylistSyncCheck network manager error: "+C.message,m9(P,C),Error(P);m9("offlinePlaylistSyncCheck fetch request error",C);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:z=$H(J);if(!J)throw m9("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(z!==void 0)Xr(z,"playlist sync");else if(!J.offlinePlaylistSyncCheckDatas||!J.offlinePlaylistSyncCheckDatas.length)throw m9("No data for playlist sync"),Error("No data for playlist sync");return U.return(J.offlinePlaylistSyncCheckDatas.map(function(n){return n.offlinePlaylistSyncCheckData}))}})},Ylr=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1;
return g.M(function(c3){switch(c3.B){case 1:return c=F.entityKey,S=g.Bx(c).entityId,g.H(c3,gX(v.B,{mode:"readonly",cX:!0},function(n1){var FJ=sO(n1,c,"playbackData"),xW=sO(n1,g.DB(S,"offlineVideoPolicy"),"offlineVideoPolicy");n1=sO(n1,g.DB(S,"transfer"),"transfer");return g.zo.all([FJ,xW,n1])}),2);
case 2:J=c3.j;A=g.k(J);C=A.next().value;P=A.next().value;z=A.next().value;U=C;n=P;r=z;if(!U||!n)return c3.return(fK(F,!0));h=[];D=((u=U)==null?0:u.playerResponseJson)?JSON.parse(U.playerResponseJson):null;if(!(r&&D&&v.Y.D("html5_refresh_deprecated_downloads"))){c3.A$(3);break}Q=t47(v,D,r);return g.H(c3,rSH(v,r),4);case 4:h=c3.j;case 3:w={lastPlayerResponseTimestampSeconds:U.playerResponseTimestamp,offlineToken:n.offlineToken,formatIds:h};G={};if((O=r)==null?0:O.maximumDownloadQuality)G.maximumDownloadQuality=
r.maximumDownloadQuality;g.f1(c3,5);a=void 0;return g.H(c3,Wvd(v,F),7);case 7:return a=c3.j,g.f1(c3,8),g.H(c3,Lat(c,v.Y,{refreshData:w,gz:G,offlineSourceData:a,mediaCapabilities:Q}),10);case 10:T=c3.j;g.Ek(c3,9,5);break;case 8:return g.Lf(c3,5),m=Zg(F)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",m9("PDE handleRefresh error"),c3.return(fK(F,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",m,"DOWNLOAD_STATE_FAILED"));
case 9:return g.H(c3,wWZ(v,T,F),11);case 11:return c3.return(fK(F,!0,T.orchestrationActions));case 5:return b=g.Lf(c3),X="PDE handleRefresh error",b instanceof Error&&(X="PDE handleRefresh error: "+b.message),AJ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C1="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.V$&&b.type==="QUOTA_EXCEEDED"&&(AJ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C1="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m9(X),c3.return(fK(F,
!1,void 0,AJ,C1,"DOWNLOAD_STATE_FAILED"))}})},AYt=function(v){if(!v.L&&!v.B){var F=f5t();
if(F){v.L=!0;var c=g.tb("OfflineLockManager");F.request("woffle_orchestration_leader:"+c,{},function(){var S,J;return g.M(function(A){switch(A.B){case 1:return g.f1(A,2),v.j=new g.jL,v.B=!0,v.L=!1,g.H(A,v.G(),4);case 4:return g.H(A,v.j.promise,5);case 5:g.Ek(A,0);break;case 2:S=g.Lf(A),v.Cp(),S instanceof Error&&(J=S,J.args=[{name:"WoLockManagerError",QP:S.name}],g.fM(J)),g.jo(A)}})})}}},pA7=function(v,F,c){c=c===void 0?[]:c;
var S,J,A,C,P,z,U,n,r,h,Q,u,D;return g.M(function(w){if(w.B==1)return c.length?g.H(w,tC(v,F),2):w.return([]);S=w.j;J=new Set;A=g.k(S);for(C=A.next();!C.done;C=A.next())if(P=C.value,z=P.id||P.key)U=g.Bx(z).entityId,J.add(U);n=[];r=g.k(c);for(h=r.next();!h.done;h=r.next())Q=h.value,u=Q.offlineVideoData,D=void 0,((D=u)==null?0:D.videoId)&&!J.has(u.videoId)&&n.push(Q);return w.return(n)})},Gr7=function(){HJ.apply(this,arguments)},Ezj=function(){HJ.apply(this,arguments)},xT=function(v){if(!v.key)throw Error("Entity key is required.");
if(!v.actionProto)throw Error("OfflineOrchestrationAction is required.");var F=g.Bx(v.key),c=g.Bx(v.actionProto.entityKey);return new TV(c.entityType,F.entityId,v.actionProto,v.parentActionId,v.rootActionId,v.childActionIds,v.prereqActionId,v.postreqActionIds,v.retryScheduleIndex,v.hasChildActionFailed,Number(v.enqueueTimeSec)*1E3)},d2H=function(v,F,c){var S,J,A,C,P,z,U,n,r,h,Q,u,D,w;
return g.M(function(G){if(G.B==1){S=F.additionalMetadadatas;J=void 0;if(S&&S.length>0)for(A=g.k(S),C=A.next();!C.done;C=A.next())if(P=C.value,P.offlineMusicPlaylistData){J=P.offlineMusicPlaylistData;break}z=F.playlistId;U=j2_(F);n=U.Cj;r=U.R4;h=c?(Number(c)*1E3).toString():Date.now().toString();Q=F.lastModifiedTimestamp?(Number(F.lastModifiedTimestamp)*1E3).toString():"0";u={id:g.DB(z,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:r,lastModifiedTimestampMillis:Q,addedTimestampMillis:h,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};D={id:g.DB(z,"musicAlbumRelease"),title:F.title,audioPlaylistId:z,trackCount:F.totalVideoCount,tracks:n,downloadMetadata:u.id};J&&(D.thumbnailDetails=(w=J.albumHqThumbnail)!=null?w:J.albumArtistThumbnail,D.artistDisplayName=J.albumArtistDisplayName,D.releaseDate=J.albumReleaseDate,D.contentRating={explicitType:J.albumReleaseExplicitType},D.releaseType=J.albumReleaseType);return g.H(G,gX(v.B,{mode:"readwrite",cX:!0},function(O){var a=yX(O,D,"musicAlbumRelease");
O=yX(O,u,"musicAlbumReleaseDownloadMetadataEntity");return g.zo.all([a,O])}),2)}return G.return(D)})},X8=function(){},qA=function(){},OO=function(v,F){var c,S,J,A,C,P,z,U,n,r,h;
return g.M(function(Q){if(Q.B==1)return c=g.DB(F,"transfer"),S=g.DB(F,"videoDownloadContextEntity"),g.H(Q,gX(v,{mode:"readonly",cX:!0},function(u){return g.zo.all([sO(u,c,"transfer"),sO(u,S,"videoDownloadContextEntity")])}),2);
J=Q.j;A=g.k(J);C=A.next().value;P=A.next().value;z=C;U=P;h={videoId:F,cotn:(n=z)==null?void 0:n.cotn,offlineModeType:(r=U)==null?void 0:r.offlineModeType};return Q.return(h)})},aLz=function(v,F){F=g.k(F);
for(var c=F.next();!c.done;c=F.next())c=c.value,ifO(c,1),v.actions.push(c);v.actions.sort(v.B)},W2r=function(v,F,c,S){var J,A,C,P,z,U,n,r;
return g.M(function(h){switch(h.B){case 1:J=[],A=g.k(F),C=A.next();case 2:if(C.done){h.A$(4);break}P=C.value;if(P.upToDate||c&&!P.shouldAutoSyncMetadata||!P.playlistId){h.A$(3);break}z={};switch(S){case "mainPlaylistEntity":U={nextAutoRefreshIntervalSeconds:P.checkInSeconds,autoSync:c};z={mainPlaylistEntityActionMetadata:U};break;case "musicPlaylist":n={autoSync:c},z={musicPlaylistEntityActionMetadata:n}}return g.H(h,o8(v,[P.playlistId],S,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",z),6);case 6:(r=
h.j)&&J.push.apply(J,g.ZQ(r));case 3:C=A.next();h.A$(2);break;case 4:return h.return(J)}})},Rbt=function(v){return{context:g.dk(),
offlinePlaylistSyncChecks:v}},fK=function(v,F,c,S,J,A){return new K_(F?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Zg(v),c,S,J,A)},Tyr=function(){HJ.apply(this,arguments)},I8=function(v){this.B=v},L_o=function(){HJ.apply(this,arguments)},QZH=function(v,F,c,S,J){var A,C,P,z,U,n;
return g.M(function(r){switch(r.B){case 1:if(A=S){r.A$(2);break}return g.H(r,x5d([F]),3);case 3:C=r.j,A=C[0];case 2:return g.H(r,zEf(v,A,c,J),4);case 4:P=r.j;z=P.mainVideoEntity;U=P.channelEntity;g.f1(r,5);var h=Aq(z.thumbnail),Q=Aq(U.avatar);return g.H(r,CK(h.concat(Q)),7);case 7:g.Ek(r,0);break;case 5:n=g.Lf(r),n instanceof Error&&n.message==="Failed to fetch"&&m9(n.message),g.jo(r)}})},oz7=function(){HJ.apply(this,arguments)},fL7=function(){HJ.apply(this,arguments)},vld=function(v,F){F=F===void 0?
0:F;
v=v.B[F];if(!v)throw F=new bH("INVALID_ENCODER_VERSION",{vP:F}),g.fM(F),F;return v},nl7=function(v){var F,c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6,dO,p7,Y,H_,PQ,yZ,ea;
return g.M(function(aO){if(aO.B==1)return g.H(aO,gX(v,{mode:"readonly",cX:!0},function(B){return e2(B,"playbackData").then(function(p){var R1=p.map(function(v_){return v_.transfer}).filter(function(v_){return!!v_}),zh=p.map(function(v_){return v_.offlineVideoPolicy}).filter(function(v_){return!!v_}),fN=p.filter(function(v_){return!!v_.key}).map(function(v_){return g.DB(g.Bx(v_.key).entityId,"downloadStatusEntity")});
R1=e2(B,"transfer",R1);zh=e2(B,"offlineVideoPolicy",zh);fN=e2(B,"downloadStatusEntity",fN);var rL=R1.then(function(v_){v_=v_.reduce(function(sr,Ej){(Ej==null?0:Ej.offlineVideoStreams)&&sr.push.apply(sr,g.ZQ(Ej.offlineVideoStreams));return sr},[]).filter(function(sr){return!!sr});
return e2(B,"offlineVideoStreams",v_)});
return g.zo.all([R1,zh,rL,fN]).then(function(v_){var sr=g.k(v_);v_=sr.next().value;var Ej=sr.next().value;var R=sr.next().value;sr=sr.next().value;return[p,v_,Ej,R,sr]})})}),2);
if(aO.B!=3)return F=aO.j,g.H(aO,gX(v,{mode:"readonly",cX:!0},function(B){return e2(B,"mainDownloadsListEntity").then(function(p){var R1,zh;return(zh=(R1=p[0])==null?void 0:R1.downloads)!=null?zh:[]})}),3);
c=aO.j;S=g.k(F);J=S.next().value;A=S.next().value;C=S.next().value;P=S.next().value;z=S.next().value;U=J;n=A;r=C;h=P;Q=z;u={};D={};w={};G={};O={};a=[];T=g.k(n);for(m=T.next();!m.done;m=T.next())(b=m.value)&&(u[b.key]=b);X=g.k(r);for(AJ=X.next();!AJ.done;AJ=X.next())(C1=AJ.value)&&(D[C1.key]=C1);c3=g.k(Q);for(n1=c3.next();!n1.done;n1=c3.next())(FJ=n1.value)&&(w[FJ.key]=FJ);xW=g.k(h);for(tJ=xW.next();!tJ.done;tJ=xW.next())(zf=tJ.value)&&(G[zf.key]=zf);eY=g.k(c);for(T6=eY.next();!T6.done;T6=eY.next())dO=
T6.value,p7=void 0,O[(p7=dO.videoItem)!=null?p7:""]=!0,dO.videoItem&&(H_=Y=void 0,PQ=(H_=(Y=g.Bx(dO.videoItem))==null?void 0:Y.entityId)!=null?H_:"",a.push({externalVideoId:PQ}));yZ=U.filter(function(B){if(!B||!B.key||!B.offlineVideoPolicy)return!1;B=g.Bx(B.key).entityId;B=g.DB(B,"downloadStatusEntity");var p;return!(B&&((p=w[B])==null?void 0:p.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
ea=yZ.map(function(B){var p=u[B.transfer],R1=[];if(p==null?0:p.offlineVideoStreams)for(var zh=g.k(p.offlineVideoStreams),fN=zh.next();!fN.done;fN=zh.next())(fN=G[fN.value])&&R1.push(fN);zh=D[B.offlineVideoPolicy];fN=O;var rL=B==null?void 0:B.playerResponseTimestamp,v_=g.Bx(zh.key).entityId;B=g.DB(v_,"mainVideoEntity");if(zh.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var sr="OFFLINE_VIDEO_STATE_DISABLED";zh.expirationTimestamp&&Number(zh.expirationTimestamp)<Date.now()/1E3&&(sr="OFFLINE_VIDEO_STATE_EXPIRED")}else if(zh.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")sr="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(p==null?void 0:p.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":sr="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":sr="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":sr="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":sr="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":sr="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":sr="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:sr="OFFLINE_VIDEO_STATE_UNKNOWN"}if(sr==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(p==null?void 0:p.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":sr="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":sr="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":sr=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}v_={id:v_,videoState:sr};if(p==null?0:p.cotn)v_.cotn=p.cotn;if(p==null?0:p.maximumDownloadQuality)v_.selectedVideoQuality=p==null?void 0:p.maximumDownloadQuality;if(p==null?0:p.lastProgressTimeMs)v_.lastProgressTimeMs=p.lastProgressTimeMs;rL&&(v_.playerResponseSavedTimeMs=String(Number(rL)*1E3));p=String;rL=0;R1=g.k(R1);for(sr=R1.next();!sr.done;sr=R1.next())if(sr=sr.value,sr.streamsProgress){sr=g.k(sr.streamsProgress);for(var Ej=sr.next();!Ej.done;Ej=sr.next()){var R=
void 0;rL+=Number((R=Ej.value.numBytesDownloaded)!=null?R:0)}}v_.downloadedBytes=p(rL);v_.selectedOfflineMode=fN[B]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";zh.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(v_.offlinePlaybackDisabledReason=zh.offlinePlaybackDisabledReason);return v_});
return aO.return({offlineVideos:ea,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:a}}})})},M_r=function(){HJ.apply(this,arguments)},V_I=function(v){var F,c,S,J,A;
g.M(function(C){switch(C.B){case 1:if(!v.B)return zV(v,"onTransferComplete"),C.return();F=v.B;v.C.stop();if(!F||!v.V){C.A$(2);break}c=bft(v.api.S(),F.cotn,v.V);return g.H(C,$ad(v,c),2);case 2:return g.H(C,UO(v,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:J=((S=F)==null?0:S.key)?g.Bx(F.key).entityId:"";if(!J||!v.L){C.A$(5);break}return g.H(C,Pi(J,v.L,v.j,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.H(C,HQr(v.j,J),7);case 7:return g.H(C,Qx(v,J),8);case 8:A=C.j,u$({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:J,ZG:F,offlineModeType:A}),d0(v),g0(v),g.jo(C)}})},jWz=function(){HJ.apply(this,arguments)},m2o=function(v){var F=(v.B.transferRetryCount||0)<3;
F&&(v=v.B,v.transferRetryCount=(v.transferRetryCount||0)+1);return F},n2r=function(){this.B=new Map},Xr=function(v,F){F=F?" for "+F:"";
if(v===0)throw v="Empty response body"+F,m9(v),Error(v);v="Response with error"+F;m9(v);throw Error(v);},$2j=function(v,F,c){this.B=v;
this.Y=F;this.L=c},DA=function(v){var F,c;
return g.M(function(S){if(S.B==1)return g.H(S,Hft(),2);if(S.B!=3){F=S.j;if(!F)throw Error("Cache API not supported");return v.length?g.H(S,F.open("yt-player-local-img"),3):S.return()}c=S.j;return g.H(S,Promise.all(v.map(function(J){return c.delete(J)})),0)})},XrO=function(){HJ.apply(this,arguments)},ZQ7=function(v,F,c,S){var J,A,C,P,z,U,n,r,h;
return g.M(function(Q){return Q.B==1?(J=F.playlistId,A=j2_(F),C=A.Cj,P=A.R4,z=c?(Number(c)*1E3).toString():Date.now().toString(),U=F.lastModifiedTimestamp?(Number(F.lastModifiedTimestamp)*1E3).toString():"0",n={id:g.DB(J,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:P,lastModifiedTimestampMillis:U,addedTimestampMillis:z,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},r={id:g.DB(J,"musicPlaylist"),title:F.title,playlistId:J,thumbnailDetails:F.thumbnail,visibility:A0Z(F),trackCount:F.totalVideoCount,
tracks:C,downloadMetadata:n.id},S&&(((h=r)==null?0:h.entityMetadata)?r.entityMetadata.nextAutoRefreshIntervalSeconds=String(S):r&&(r.entityMetadata={nextAutoRefreshIntervalSeconds:String(S)})),g.H(Q,gX(v.B,{mode:"readwrite",cX:!0},function(u){var D=yX(u,r,"musicPlaylist");u=yX(u,n,"musicPlaylistDownloadMetadataEntity");return g.zo.all([D,u])}),2)):Q.return(r)})},yx=function(){NA.apply(this,arguments);
this.bX="musicTrack"},K_I=function(v,F,c){F=F===void 0?43200:F;
c=c===void 0?!0:c;var S=S===void 0?!1:S;var J,A,C;return g.M(function(P){switch(P.B){case 1:if(!v.K.xU())return P.return([]);J=[];g.f1(P,2);return g.H(P,ESZ(F,c,S),4);case 4:J=P.j;g.Ek(P,3);break;case 2:A=g.Lf(P),A instanceof Error&&A.message==="No data"||A instanceof Error&&A.message==="Empty response body"&&m9(A.message);case 3:return C=W2r(v,J,c,"mainPlaylistEntity"),P.return(C)}})},csd=function(v,F){return gX(v,{mode:"readwrite",
cX:!0},function(c){return lTZ(c,F,"offlineOrchestrationActionWrapperEntity")})},qlH=function(){HJ.apply(this,arguments)},ILo=function(){HJ.apply(this,arguments)},gz7=function(v,F,c){var S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T;
return g.M(function(m){S=[];J=new Set;if((A=c)==null?0:(C=A.downloadedTracks)==null?0:C.length)for(P=g.k(c.downloadedTracks),z=P.next();!z.done;z=P.next())U=z.value,J.add(U);if(v.tracks){n=g.k(v.tracks);for(r=n.next();!r.done;r=n.next())h=r.value,J.has(h)||S.push(h);Q=g.k(F);for(u=Q.next();!u.done;u=Q.next())if(D=u.value,D.id!==v.id&&(w=D.tracks))for(G=g.k(w),O=G.next();!O.done;O=G.next())a=O.value,T=S.indexOf(a),T!==-1&&S.splice(T,1)}return m.return(S)})},sWf=function(v,F,c,S){g.q.call(this);
var J=this;this.j=v;this.api=F;this.Ky=c;this.Mk=S;this.K=new g.y6;this.C=new g.W6(function(){J.B&&J.B.transferState==="TRANSFER_STATE_TRANSFERRING"&&J.K.xU()&&((J.B.transferRetryCount||0)<3?b$(J.W,J.V,!1,!1):tq(J.W,J.V.videoDetails.videoId),J.mN("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Bz=this.wS=0;this.bX=this.G=!1;this.aN=g.Sp(this.api.S().experiments,"html5_transfer_processing_logs_interval");this.Db=new g.KJ(this);this.gZ={vv$:function(){return J.C},
sEz:function(){return J.Mk},
Iq:function(){return J.K}};
this.py=this.j.observe(this.W2.bind(this));this.W=new js_(F,this);this.qk=new YI7(F);this.h$=new $T(this.j);this.Ub=this.K.listen("publicytnetworkstatus-online",this.x8.bind(this));this.zc=this.K.listen("publicytnetworkstatus-offline",this.h85.bind(this));this.bX=this.api.S().D("html5_less_transfer_processing_logs");g.V(this,this.Db);this.Db.N(F,"offlinetransferpause",this.w_5);if(g.j3(this.api.S()))this.L="mainVideoDownloadStateEntity";else if(g.Gk(this.api.S())||g.vm(this.api.S()))this.L="musicTrackDownloadMetadataEntity"},
NoO=function(v,F){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:v},metadata:F,statusCode:void 0,csn:void 0,can:void 0}},l1I=function(){var v,F,c;
return g.M(function(S){if(S.B==1)return g.f1(S,2),g.H(S,g.Lc(),4);if(S.B!=2){v=S.j;if(!v||!g.oZ()||typeof g.C7.BroadcastChannel==="undefined")return S.return();F=new gSr;return S.return(new ZA(v,F))}c=g.Lf(S);c instanceof Error&&g.fM(c);return S.return()})},ySH=function(v,F,c){var S,J,A,C,P,z,U,n,r,h,Q,u;
return g.M(function(D){switch(D.B){case 1:S=F.retryScheduleIndex+2===3;if(c.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){D.A$(2);break}if(c.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){D.A$(0);break}f1z(F,c,S);if(c.B&&F.retryScheduleIndex+1<3)return g.H(D,nzf(v,[F]),0);A=((J=c)==null?0:J.j)?c.j:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";C={entityKey:F.action.entityKey,failureReason:A};P=void 0;g.j3(v.Y)?P="mainVideoDownloadStateEntity":g.Gk(v.Y)&&(P="musicTrackDownloadMetadataEntity");
if(!P||!c.downloadState){D.A$(7);break}z=g.Bx(F.action.entityKey).entityId;return g.H(D,Pi(z,P,v.j,c.downloadState),7);case 7:hq(v.W,C);if(c.downloadState==="DOWNLOAD_STATE_FAILED"&&v.Y.D("html5_auto_retry_failed_pde_actions")){D.A$(0);break}m9("Orchestration result is not retryable, deleting action");return g.H(D,slI(v.j,LK(F).key),0);case 2:U=void 0;try{U=(n=c.C)==null?void 0:n.map(function(w){return v.createAction(w,F)})}catch(w){return f1z(F,c,S),r={entityKey:F.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},hq(v.W,r),m9("Orchestration subactions creation error",w),D.return()}f1z(F,c,S,U);if(!U){D.A$(12);break}h=U.map(function(w){return LK(w)});
Q=0;case 13:if(!(Q<U.length)||v.V){D.A$(15);break}return g.H(D,gX(v.j,{mode:"readwrite",cX:!0},function(w){var G=[];G.push(lTZ(w,h.slice(Q,Q+10),"offlineOrchestrationActionWrapperEntity"));return g.zo.all(G)}),16);
case 16:Q+=10;D.A$(13);break;case 15:if(v.V)return v.V=!1,D.return();case 12:return u=LK(F),g.H(D,slI(v.j,u.key),17);case 17:ifO(F,4),g.jo(D)}})},bQo=function(){HJ.apply(this,arguments)},qIr=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w;
return g.M(function(G){if(G.B==1)return c=g.DB("main_downloads_library_id","mainDownloadsLibraryEntity"),S=g.DB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.H(G,gX(v,{mode:"readonly",cX:!0},function(O){return g.zo.all([sO(O,c,"mainDownloadsLibraryEntity"),sO(O,S,"mainDownloadsListEntity"),sO(O,g.Mn,"mainDownloadsListEntity")])}),2);
J=G.j;A=g.k(J);C=A.next().value;P=A.next().value;z=A.next().value;U=C;n=P;r=z;if(!U)return G.A$(0);if(F===g.Mn&&((h=r)==null?0:h.downloads))r.downloads=[];else if((Q=n)==null?0:Q.downloads)for(u=g.Bx(F).entityType,D=0;D<n.downloads.length;D++)if(w=n.downloads[D],u==="mainVideoEntity"&&w.videoItem===F){n.downloads.splice(D,1);break}else if(u==="mainPlaylistEntity"&&w.playlistItem===F){n.downloads.splice(D,1);break}return g.H(G,gX(v,{mode:"readwrite",cX:!0},function(O){var a=[yX(O,U,"mainDownloadsLibraryEntity")];
n&&a.push(yX(O,n,"mainDownloadsListEntity"));r&&a.push(yX(O,r,"mainDownloadsListEntity"));return g.zo.all(a)}),0)})},t_H=function(){HJ.apply(this,arguments)},prY=function(v){return g.M(function(F){if(F.B==1)F=g.H(F,JsZ(),2);
else{var c=v.h$;var S=g.Pn();S=Object.keys(S);c=Hwf(c,S);F=g.H(F,c,0)}return F})},vvj=function(){HJ.apply(this,arguments)},FLY=function(v){v.B&&(v.V=!0,MA(v))},Aq=function(v){if(!v||!v.thumbnails)return[];
var F=[];v=g.k(v.thumbnails);for(var c=v.next();!c.done;c=v.next())c=c.value,c.url&&F.push(c.url);return F},Zg=function(v){var F,c,S;
return((S=(F=v.actionMetadata)==null?void 0:(c=F.retryScheduleIntervalsInSeconds)==null?void 0:c.length)!=null?S:0)>0},sLf=function(v,F){var c,S,J,A,C,P,z,U;
return g.M(function(n){switch(n.B){case 1:return c=Zg(F),S=g.Bx(F.entityKey).entityId,g.f1(n,2),g.H(n,Hi.getInstance(),4);case 4:J=n.j;if(!J)throw Error("prefStorage is undefined");return g.H(n,J.get("psi"),5);case 5:A=n.j;C=g.x(F.actionMetadata,cEd);if(((P=A)==null?void 0:P.isPaused)!==!1||(z=C)==null||!z.lastPlaybackPositionSeconds){n.A$(6);break}U={key:g.DB(S,"videoPlaybackPositionEntity"),videoId:S,lastPlaybackPositionSeconds:C.lastPlaybackPositionSeconds};return g.H(n,GV(v.B,U,"videoPlaybackPositionEntity"),
6);case 6:g.Ek(n,3);break;case 2:return g.Lf(n),n.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return n.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},Fvt=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},SMz=function(){HJ.apply(this,arguments)},Dxz=function(v,F){var c,S,J,A,C,P,z,U;
return g.M(function(n){c=Aq(v.avatar);S=g.k(F);for(J=S.next();!J.done;J=S.next())if(A=J.value,A.id!==v.id)for(C=g.k(Aq(A.avatar)),P=C.next();!P.done;P=C.next())z=P.value,U=c.indexOf(z),U!==-1&&c.splice(U,1);return n.return(c)})},pK=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!v.entityKey},JEf=function(v,F){this.B=v;
this.L=F},CDd=function(v){var F,c,S,J;
g.M(function(A){switch(A.B){case 1:if(!v.B){zV(v,"onTransferPausedByUser");A.A$(2);break}F=v.B;v.C.stop();return g.H(A,UO(v,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:S=((c=F)==null?0:c.key)?g.Bx(F.key).entityId:"";if(!S||!v.L){A.A$(4);break}return g.H(A,Pi(S,v.L,v.j,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.H(A,Qx(v,S),6);case 6:J=A.j,AEo({videoId:S,ZG:F,offlineModeType:J});case 2:d0(v),g0(v),g.jo(A)}})},c0f=function(v){var F=new g.ry("und",new g.dG("Default","und",!0));
F.captionTracks=v.captionTracks;return F},enj=function(){HJ.apply(this,arguments)},PDo=function(){HJ.apply(this,arguments)},ESZ=function(v,F,c,S){var J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6;
return g.M(function(dO){switch(dO.B){case 1:return g.H(dO,a8(),2);case 2:J=dO.j;if(!J)return dO.return([]);A=[];if((C=S)==null?0:C.length){A=S;dO.A$(3);break}return g.H(dO,tC(J,"mainPlaylistEntity"),4);case 4:A=dO.j;case 3:if(!A.length)return dO.return([]);P=[];z=Date.now()/1E3;U=g.k(A);n=U.next();case 5:if(n.done)return P.length?g.H(dO,lLH(P),10):dO.return([]);r=n.value;if(!r.downloadState){h=void 0;dO.A$(8);break}return g.H(dO,jb(J,r.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:h=
dO.j;case 8:Q=h;u=void 0;w=(D=(u=r)==null?void 0:u.entityMetadata)&&D.nextAutoRefreshIntervalSeconds?Number(D.nextAutoRefreshIntervalSeconds):NaN;G=Number.isNaN(w)?v:w;a=O=void 0;T=((O=Q)==null?0:O.lastSyncedTimestampMillis)?Number((a=Q)==null?void 0:a.lastSyncedTimestampMillis)/1E3:0;b=m=void 0;X=((m=Q)==null?0:m.addedTimestampMillis)?Number((b=Q)==null?void 0:b.addedTimestampMillis)/1E3:0;if(c||!D||T+G<=z){AJ=[];C1=void 0;if((C1=r.videos)==null?0:C1.length)for(c3=g.k(r.videos),n1=c3.next();!n1.done;n1=
c3.next())FJ=n1.value,xW=JSON.parse(g.Bx(FJ).entityId),xW.videoId&&AJ.push(xW.videoId);tJ="0";D&&(zf=void 0,tJ=String(Number((zf=D.offlineLastModifiedTimestampSeconds)!=null?zf:0).toFixed()));eY={playlistId:r.playlistId,videoIds:AJ,offlineLastModifiedTimestamp:tJ,autoSync:F,offlineDateAddedTimestamp:String(X.toFixed())};P.push(eY)}n=U.next();dO.A$(5);break;case 10:return T6=dO.j,dO.return(T6)}})},zn7=function(){var v,F,c,S,J,A;
return g.M(function(C){switch(C.B){case 1:return g.H(C,a8(),2);case 2:v=C.j;if(!v)return C.return([]);F=Date.now()/1E3;return g.H(C,tC(v,"offlineVideoPolicy"),3);case 3:c=C.j,S=g.k(c),J=S.next();case 4:if(J.done){C.A$(6);break}A=J.value;if(!(A.expirationTimestamp&&Number(A.expirationTimestamp)<F)){C.A$(5);break}A.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";A.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.H(C,GV(v,A,"offlineVideoPolicy"),5);
case 5:J=S.next();C.A$(4);break;case 6:return C.return(c.map(function(P){return P.key}))}})},UgI=function(v,F,c,S){S=S===void 0?!1:S;
var J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O;return g.M(function(a){switch(a.B){case 1:return J=[],g.H(a,ebd(),2);case 2:return(A=a.j)||S?g.H(a,l5Y(F,c),3):a.return([]);case 3:C=a.j;if((P=C)==null||!P.length)return a.return([]);z={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};U=g.k(C);n=U.next();case 4:if(n.done){a.A$(6);break}h=r=n.value;Q=h.actionType;u=h.entityKey;D=h.actionMetadata;if(!(Q&&u&&D)||g.x(D,Lv7)){a.A$(5);break}Q==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(D.offlineLoggingData=
z);w=g.Bx(u);G=w.entityId;return g.H(a,o8(v,[G],"mainVideoEntity",Q,D),8);case 8:O=a.j,J=J.concat(O);case 5:n=U.next();a.A$(4);break;case 6:return a.return(J)}})},XWZ=function(v,F,c){var S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1;
return g.M(function(c3){S=[];J=new Set;if(c.length)for(A=g.k(c),C=A.next();!C.done;C=A.next())if(P=C.value,z=void 0,(z=P.downloads)==null?0:z.length)for(U=g.k(P.downloads),n=U.next();!n.done;n=U.next())r=n.value,r.videoItem&&(h=g.Bx(r.videoItem).entityId,J.add(h));if(v.videos){Q=g.k(v.videos);for(u=Q.next();!u.done;u=Q.next())D=u.value,w=JSON.parse(g.Bx(D).entityId),w.videoId&&!J.has(w.videoId)&&S.push(w.videoId);G=g.k(F);for(O=G.next();!O.done;O=G.next())if(a=O.value,a.key!==v.key&&(T=a.videos))for(m=
g.k(T),b=m.next();!b.done;b=m.next())X=b.value,AJ=JSON.parse(g.Bx(X).entityId),AJ.videoId&&(C1=S.indexOf(AJ.videoId),C1!==-1&&S.splice(C1,1))}return c3.return(S)})},nvI=function(){HJ.apply(this,arguments)},uUo=function(v,F){var c,S,J,A,C,P,z;
return g.M(function(U){if(U.B==1)return c=g.DB("music_downloads_library_id","musicDownloadsLibraryEntity"),g.H(U,jb(v,c,"musicDownloadsLibraryEntity"),2);S=U.j;if(!S)return U.A$(0);J=g.Bx(F).entityType;J==="musicTrack"?A=S.downloadedTracks:J==="musicPlaylist"&&(A=S.downloadedPlaylists);if((C=A)==null?0:C.length)for(P=0;P<A.length;P++)if(z=A[P],z===F){A.splice(P,1);break}return g.H(U,GV(v,S,"musicDownloadsLibraryEntity"),0)})},HQr=function(v,F){var c,S,J,A,C;
return g.M(function(P){if(P.B==1)return c=g.DB(F,"offlineVideoStreams"),g.H(P,jb(v,c,"offlineVideoStreams"),2);S=P.j;if(!S||!S.streamsProgress)return P.return();J=g.k(S.streamsProgress);for(A=J.next();!A.done;A=J.next())C=A.value,C.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",C.numTotalBytes!==C.numBytesDownloaded&&(C.numBytesDownloaded=C.numTotalBytes);return g.H(P,GV(v,S,"offlineVideoStreams"),0)})},rEz=function(){HJ.apply(this,arguments)},UxZ=function(v,F){var c=v.B.objectStore("EntityAssociationStore");
return c.index("byParentEntityKey").getAll(IDBKeyRange.only(F)).then(function(S){var J=[];S=g.k(S);for(var A=S.next();!A.done;A=S.next())A=A.value,J.push(c.index("byChildEntityKey").getAll(A.childEntityKey));return g.zo.all(J)}).then(function(S){var J=[];
S=g.k(S);for(var A=S.next();!A.done;A=S.next())A=A.value,A.length===1&&J.push(A[0].childEntityKey);return J})},hnY=function(){HJ.apply(this,arguments)},tq=function(v,F){var c=g.e1(F);
if(c===1||c===0)return Promise.resolve();(c=Zfr(v,F))&&c.stopVideo();v.L=0;return F2_(F)},m9=function(v,F,c){g.Hz(new g.VS("Woffle: "+v,c?{cotn:c}:""));
F instanceof Error&&g.Hz(F)},XzH=function(v){var F;
return g.M(function(c){if(c.B==1)return g.H(c,g.Nu5(v),2);F=c.j;return c.return(F.filter(function(S){return!!S.url}).map(function(S){return S.url}))})},tHH=function(v,F){var c;
return g.M(function(S){return S.B==1?g.H(S,gJ7(v,F),2):(c=S.j)?g.H(S,gX(v,{mode:"readwrite",cX:!0},function(J){var A=[yX(J,c.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];c.mainDownloadsListEntity&&A.push(yX(J,c.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.zo.all(A)}),0):S.A$(0)})},War=function(v){for(var F,c=g.k(v.additionalMetadatas),S=c.next();!S.done;S=c.next())S=S.value,S.offlineMusicVideoData&&(F=S.offlineMusicVideoData);
var J,A,C,P,z;return{id:g.DB(v.videoId,"musicTrack"),videoId:v.videoId,title:v.title,thumbnailDetails:v.thumbnail,lengthMs:String(Number(v.lengthSeconds)*1E3),albumTitle:(J=F)==null?void 0:J.releaseTitle,musicVideoType:(A=F)==null?void 0:A.musicVideoType,contentRating:{explicitType:(C=F)==null?void 0:C.explicitType},artistNames:((P=F)==null?void 0:P.byline)||((z=F)==null?void 0:z.channelName),downloadMetadata:g.DB(v.videoId,"musicTrackDownloadMetadataEntity")}},QLj=function(){HJ.apply(this,arguments)},
$ad=function(v,F){var c,S,J;
return g.M(function(A){switch(A.B){case 1:return g.f1(A,2),(c=!!F.captionTracks.length||!!F.pB)?g.H(A,uWd(F.videoId),4):A.return();case 4:return(S=A.j)?A.return():g.H(A,ssO(v.qk,F),5);case 5:g.Ek(A,0);break;case 2:J=g.Lf(A),m9("Caption downloading error",J,F.cotn),g.jo(A)}})},x2r=function(v,F){F.length!==0&&F.forEach(function(c){c=xT(c);
c.retryScheduleIndex<3&&aLz(v.B,[c])})},LK=function(v){return{key:g.DB(v.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:v.action,parentActionId:v.parentActionId,rootActionId:v.rootActionId,childActionIds:v.childActionIds,prereqActionId:v.prereqActionId,postreqActionIds:v.postreqActionIds,retryScheduleIndex:v.retryScheduleIndex,hasChildActionFailed:v.hasChildActionFailed,enqueueTimeSec:(v.B/1E3).toFixed()}},kpo=function(v,F,c){if(!c){var S=S===void 0?!1:S;
c=v.B.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!c||S)c=g.gg(16),v.B.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",c)}v={flowNonce:c,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:F.eventType};F.metadata&&(v.flowMetadata=F.metadata);F.statusCode!==void 0&&(v.flowEventStatus=F.statusCode);F.csn&&(v.csn=F.csn);F.can&&(v.can=F.can);g.wo("flowEvent",v,void 0)},u3t=function(v,F,c){this.B=v;
this.Y=F;this.L=c},N$r=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G;
return g.M(function(O){switch(O.B){case 1:return c=Zg(F),S=g.Bx(F.entityKey),J=S.entityId,A=[],g.f1(O,2),g.H(O,PLd(v,J),4);case 4:A=O.j;if((C=A)==null||!C.length){O.A$(5);break}return g.H(O,YgZ(v.B,F.entityKey),5);case 5:g.Ek(O,3);break;case 2:return P=g.Lf(O),z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.V$&&P.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
O.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,z,U));case 3:return n=[],g.H(O,pA7(v.B,"musicTrack",A),7);case 7:A=O.j;if(A.length)for(r=g.k(A),h=r.next();!h.done;h=r.next())if(Q=h.value,u=Q.offlineVideoData,D=void 0,(D=u)==null?0:D.videoId)w=void 0,G=Number(((w=F.actionMetadata)==null?void 0:w.priority)||0)+1,n.push(qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",u.videoId,"musicTrack",G,F8,ci(F,u,J)));return O.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,n))}})},
k5_=function(){HJ.apply(this,arguments)},iDz=function(){HJ.apply(this,arguments)},Sl7=function(v,F,c,S,J){var A;
return g.M(function(C){if(C.B==1)return A=new KK(v,F,c,S,J),g.H(C,DgO(A),2);LS7(A);return C.return(A)})},ci=function(v,F,c){F={track:War(F)};
c&&(F.playlistId=c);if(v=g.x(v.actionMetadata,CLo))F.maximumDownloadQuality=v.maximumDownloadQuality;return{musicTrackEntityActionMetadata:F}},cYo=function(v,F,c){var S=hEz(F);
return jl7(v,S).then(function(){return uiZ(v,F,c)})},xg_=function(){HJ.apply(this,arguments)},vL=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!v.entityKey},WLd=function(v,F){var c,S,J,A,C,P,z,U,n,r;
return g.M(function(h){switch(h.B){case 1:return c=Zg(F),S=g.Bx(F.entityKey).entityId,g.H(h,gX(v.B,{mode:"readonly",cX:!0},function(Q){var u=sO(Q,F.entityKey,"transfer");Q=sO(Q,g.DB(S,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.zo.all([u,Q])}),2);
case 2:J=h.j;A=g.k(J);C=A.next().value;P=A.next().value;z=C;U=P;if(!z||z.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return h.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.f1(h,3);z.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.H(h,GV(v.B,z,"transfer"),5);case 5:n=g.Bx(z.key).entityId;wzd({videoId:n,ZG:z,offlineModeType:(r=U)==null?void 0:r.offlineModeType});g.Ek(h,4);break;case 3:return g.Lf(h),h.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return h.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},iwz=function(v,F,c,S){var J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T;
return g.M(function(m){switch(m.B){case 1:J=Date.now().toString();c||(c=J);A=F.videos;C=F.playlistId;P=[];z=[];if(A)for(U=g.k(A),n=U.next();!n.done;n=U.next()){r=n.value;h=r.offlineVideoData;if(!h||!h.videoId)throw m9("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");Q=h.videoId;u={videoId:Q,playlistId:C};D={id:g.DB(JSON.stringify(u),"mainPlaylistVideoEntity"),video:g.DB(Q,"mainVideoEntity")};P.push(D);z.push(D.id)}G={key:g.DB(C,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:c,lastSyncedTimestampMillis:J};O={key:g.DB(C,"mainPlaylistEntity"),playlistId:C,videos:z,title:F.title,thumbnailStyleData:Owd(F),visibility:yUf(F),downloadState:G.key};F.channel&&(a=F.channel.offlineChannelData,w=Rcj(g.DB(C,"ytMainChannelEntity"),a),O.channelOwner=w.id);((T=O)==null?0:T.entityMetadata)?(O.entityMetadata.offlineLastModifiedTimestampSeconds=F.lastModifiedTimestamp,S&&(O.entityMetadata.nextAutoRefreshIntervalSeconds=String(S))):O&&(O.entityMetadata={nextAutoRefreshIntervalSeconds:S?
String(S):void 0,offlineLastModifiedTimestampSeconds:F.lastModifiedTimestamp});g.f1(m,2);return g.H(m,gX(v.B,{mode:"readwrite",cX:!0},function(b){var X=yX(b,O,"mainPlaylistEntity"),AJ=yX(b,G,"mainPlaylistDownloadStateEntity");X=[X,AJ];AJ=g.k(P);for(var C1=AJ.next();!C1.done;C1=AJ.next())X.push(yX(b,C1.value,"mainPlaylistVideoEntity"));w&&X.push(yX(b,w,"ytMainChannelEntity"));return g.zo.all(X)}),4);
case 4:g.Ek(m,3);break;case 2:throw g.Lf(m),m9("PES failure for playlist"),Error("PES failure for playlist");case 3:return m.return({mainPlaylistEntity:O,D1y:w,N1c:P})}})},B$t=function(v,F){var c,S;
return g.M(function(J){switch(J.B){case 1:return c=Zg(F),g.f1(J,2),S=g.Bx(F.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.H(J,p_(v.B,F,v.L),5):g.H(J,vi(S,"musicPlaylist",v.B,F,v.L),6);case 6:return g.H(J,uUo(v.B,F.entityKey),5);case 5:g.Ek(J,3);break;case 2:return g.Lf(J),J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},JSd=function(v){var F;
return g.M(function(c){switch(c.B){case 1:if(!v.j)return m9("transferManager is undefined"),c.return();if(v.j.B){c.A$(2);break}return g.H(c,g0(v.j),2);case 2:if(!v.Y.D("woffle_enable_main_downloads_library")){c.A$(4);break}return g.H(c,v.z$(),4);case 4:if(!v.Y.D("html5_offline_playback_position_sync")){c.A$(6);break}return g.H(c,v.Q2(),7);case 7:return g.H(c,v.AE(864E5),6);case 6:return g.H(c,v.refreshAllStaleEntities(43200,!0),9);case 9:return g.H(c,v.XB(),10);case 10:if(!v.Y.D("html5_retry_downloads_for_expiration")){c.A$(11);
break}return g.H(c,v.ek(),11);case 11:return v.G=g.bc(function(){v.refreshAllStaleEntities(43200,!0);v.XB()},9E5),g.Au(g.Ve(),function(){return v.wm()}),g.H(c,a8(),13);
case 13:return F=c.j,g.H(c,rYd(F),14);case 14:FLY(v.L),g.jo(c)}})},wP7=function(){HJ.apply(this,arguments)},YgZ=function(v,F){var c,S,J,A,C,P,z,U,n;
return g.M(function(r){if(r.B==1)return c=g.DB("music_downloads_library_id","musicDownloadsLibraryEntity"),g.H(r,jb(v,c,"musicDownloadsLibraryEntity"),2);(S=r.j)||(S={id:c});J=g.Bx(F).entityType;J==="musicTrack"?(A=S.downloadedTracks)!=null&&A.includes(F)||(S.downloadedTracks=((C=S.downloadedTracks)!=null?C:[]).concat(F)):J==="musicPlaylist"?(P=S.downloadedPlaylists)!=null&&P.includes(F)||(S.downloadedPlaylists=((z=S.downloadedPlaylists)!=null?z:[]).concat(F)):J!=="musicAlbumRelease"||(U=S.downloadedAlbumReleases)!=
null&&U.includes(F)||(S.downloadedAlbumReleases=((n=S.downloadedAlbumReleases)!=null?n:[]).concat(F));return g.H(r,GV(v,S,"musicDownloadsLibraryEntity"),0)})},Rnj=function(){HJ.apply(this,arguments)},tfo=function(v){switch(v){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
bft=function(v,F,c){return new g.E5(v,{cotn:F,
raw_player_response:c,download_media:!0,start:Infinity,disable_watch_next:!0})},ODt=function(v,F){var c,S,J,A,C,P,z,U,n,r;
return g.M(function(h){switch(h.B){case 1:return c=Zg(F),g.f1(h,2),S=g.Bx(F.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.H(h,Z3j(v.B,F,v.L,(n=F.actionMetadata)==null?void 0:(r=n.offlineLoggingData)==null?void 0:r.offlineDeleteReason),5):g.H(h,OO(v.B,S),6);case 6:J=h.j;A=g.x(F.actionMetadata,i$);if(P=(C=A)==null?void 0:C.playlistId)J.playlistId=P;J.offlineDeleteReason=(z=F.actionMetadata)==null?void 0:(U=z.offlineLoggingData)==null?void 0:U.offlineDeleteReason;return g.H(h,R8(S,v.B,F,v.L,J),7);
case 7:if(!v.Y.D("woffle_enable_main_downloads_library")){h.A$(5);break}return g.H(h,qIr(v.B,F.entityKey),5);case 5:g.Ek(h,3);break;case 2:return g.Lf(h),h.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},lTZ=function(v,F,c){F=F.map(function(S){return yX(v,S,c)});
return g.zo.all(F)},DgO=function(v){var F;
return g.M(function(c){if(c.B==1)return g.H(c,tC(v.j,"offlineOrchestrationActionWrapperEntity"),2);F=c.j;return g.H(c,W_O(v,F),0)})},YMt=function(v,F,c,S,J,A){var C,P,z;
return g.M(function(U){C="STREAM_TYPE_UNKNOWN";c.video&&c.audio?(C="STREAM_TYPE_AUDIO_AND_VIDEO",m9("unexpected stream type")):c.video&&!c.audio?C="STREAM_TYPE_VIDEO":!c.video&&c.audio&&(C="STREAM_TYPE_AUDIO");P=g.DB(F,"offlineVideoStreams");z={numBytesDownloaded:J.toFixed(),numTotalBytes:A.toFixed(),streamType:C,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(S),itag:C==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(c.itag):void 0};return g.H(U,gX(v,{mode:"readwrite",cX:!0},
function(n){var r=sO(n,P,"offlineVideoStreams"),h=sO(n,g.DB(F,"transfer"),"transfer");return g.zo.all([r,h]).then(function(Q){Q=g.k(Q);var u=Q.next().value;Q=Q.next().value;if(!Q)return nK(n,P).then(function(){});
var D=glH(u);u=lVr(u,S,z,P);var w=yX(n,u,"offlineVideoStreams");glH(u)>D&&(Q.lastProgressTimeMs=Date.now().toString());D=[w];Q.offlineVideoStreams||(Q.offlineVideoStreams=[]);Q.offlineVideoStreams.indexOf(P)===-1&&(Q.offlineVideoStreams.push(P),D.push(yX(n,Q,"transfer")));return g.zo.all(D)})}),0)})},J0O=function(v,F){return g.zu(v.B.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(F)},function(c){return g.zo.all([c.delete(),
jl7(v,c.cursor.primaryKey)]).then(function(){r0(v,c.cursor.primaryKey,F);return g.sI(c)})})},Jq=function(v,F,c,S,J){var A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ;
return g.M(function(C1){switch(C1.B){case 1:return A=g.DB(v,"musicTrack"),C=g.DB(v,"transfer"),g.H(C1,gX(F,{mode:"readonly",cX:!0},function(c3){return g.zo.all([sO(c3,A,"musicTrack"),sO(c3,C,"transfer"),e2(c3,"musicTrack"),e2(c3,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:P=C1.j;z=g.k(P);U=z.next().value;n=z.next().value;r=z.next().value;h=z.next().value;Q=U;u=n;D=r;w=h;if(!Q){C1.A$(3);break}return g.H(C1,bwO(Q,D),4);case 4:return G=C1.j,g.H(C1,DA(G),3);case 3:O=[];a=g.k(w);for(T=a.next();!T.done;T=a.next())m=T.value,b=g.Bx(m.key).entityId,X=xT(m),AJ=g.Bx(X.action.entityKey).entityId,b!==v&&AJ!==v||Wi(c,m.actionProto)||O.push(m.key);return g.H(C1,gX(F,{mode:"readwrite",cX:!0},function(c3){var n1=O.map(function(FJ){return nK(c3,FJ)});
n1.push(nK(c3,A,{nx:!0}));return g.zo.all(n1)}),6);
case 6:w0(u),J&&Bi(J),hq(S,{entityKey:A,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.jo(C1)}})},Toj=function(v){var F;
if((F=v.onResponseReceivedActions)!=null&&F.length){var c;v=(c=g.x(g.x(v.onResponseReceivedActions[0],G5H),g.Jaj))==null?void 0:c.actions;if(v!=null&&v.length)return v}},EvO=function(v,F,c){var S,J;
g.M(function(A){switch(A.B){case 1:if(!v.B)return zV(v,"onTransferProgress: "+F),A.return();if(v.B.transferState==="TRANSFER_STATE_TRANSFERRING"){A.A$(2);break}return g.H(A,UaH(v),2);case 2:S=Date.now();if(!(S-v.wS>1E3)){A.A$(4);break}v.wS=S;return g.H(A,YMt(v.j,c.videoId,c.j,c.cQ,c.bytesDownloaded,c.B),5);case 5:if(v.bX&&!(v.bX&&S-v.Bz>v.aN)){A.A$(4);break}v.Bz=S;return g.H(A,Qx(v,F),7);case 7:J=A.j,pW7({videoId:F,ZG:v.B,offlineModeType:J},c.bytesDownloaded,c.B);case 4:v.C.start(108E5),g.jo(A)}})},
dgr=function(){HJ.apply(this,arguments)},dBH=function(v){var F;
v=g.x((F=v.getWatchNextResponse())==null?void 0:F.currentVideoEndpoint,g.JI);if(v==null?0:v.playlistId)var c=v.playlistId;return c},aV7=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q;
return g.M(function(u){switch(u.B){case 1:return c=Zg(F),g.H(u,tC(v.B,"videoPlaybackPositionEntity"),2);case 2:S=u.j;if(S.length===0)return u.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.f1(u,3);return g.H(u,Hi.getInstance(),5);case 5:J=u.j;if(!J)throw Error("prefStorage is undefined");return g.H(u,J.get("psi"),6);case 6:return A=u.j,z=(P=(C=A)==null?void 0:C.pG)!=null?P:"0",g.H(u,oSH(S,z),7);case 7:return U=u.j,n={isPaused:U.watchHistoryPaused,pG:U.syncTimestampUsec},g.H(u,J.set("psi",
n),8);case 8:if(n.isPaused){u.A$(9);break}r=g.x(U.frameworkUpdates,S2);if(!U.frameworkUpdates||!r){u.A$(9);break}return g.H(u,rUt(r),9);case 9:g.Ek(u,4);break;case 3:return h=g.Lf(u),Q="PPE handleRefresh error: "+(h instanceof Error?h.message:"unknown error"),m9(Q),u.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return u.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},T$f=function(v){var F,c,S,J,A,C,P;
return g.M(function(z){if(z.B==1)return g.H(z,K2Y(v),2);F=z.j;c=[];S=g.k(F);for(J=S.next();!J.done;J=S.next())A=J.value,C=g.Bx(A.key),P=C.entityId,Ihz(v.B,P)||c.push(A);return g.H(z,W_O(v,c),0)})},p_=function(v,F,c){var S,J,A,C,P,z,U;
return g.M(function(n){if(n.B==1)return g.H(n,gX(v,{mode:"readwrite",cX:!0},function(r){var h=e2(r,"transfer"),Q=e2(r,"offlineOrchestrationActionWrapperEntity");return g.zo.all([h,Q]).then(function(u){u=g.k(u);var D=u.next().value;var w=u.next().value;u=LLI.map(function(T){return J0O(r,T)});
w=g.k(w);for(var G=w.next();!G.done;G=w.next()){G=G.value;var O=g.Bx(G.actionProto.entityKey).entityType==="musicTrack",a=G.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Wi(F,G.actionProto)||O&&(!O||a)||u.push(nK(r,G.key,{nx:!0}))}return g.zo.all(u).then(function(){return D})})}),2);
S=n.j;J=g.k(S);for(A=J.next();!A.done;A=J.next())C=A.value,w0(C),P=g.Bx(C.key).entityId,z={videoId:P,offlineDeleteReason:void 0,cotn:C.cotn},Bi(z),U=g.DB(P,"musicTrack"),hq(c,{entityKey:U,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.H(n,V4o(),0)})},ov7=function(){Mt.apply(this,arguments)},fV7=function(v,F){var c;
return g.M(function(S){return F.length?(c=Fvt(),g.c1(c,l$,{isEnqueuedForExpiredStreamUrlRefetch:!0}),v.api.jD("qrd",{v:F.length}),S.return(o8(v,F,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c))):S.return([])})},Mk7=function(){HJ.apply(this,arguments)},FSI=function(v,F,c){try{return v.L(F,c)}catch(S){Pcd(S,QW7)}},HDH=function(v,F){var c,S;
return g.M(function(J){switch(J.B){case 1:return c=Zg(F),g.f1(J,2),S=g.Bx(F.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.H(J,p_(v.B,F,v.L),5):g.H(J,vi(S,"musicAlbumRelease",v.B,F,v.L),6);case 6:return g.H(J,uUo(v.B,F.entityKey),5);case 5:g.Ek(J,3);break;case 2:return g.Lf(J),J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},Vkr=function(v,F){this.B=v;
this.L=F},jLZ=function(v,F,c){this.B=v;
this.Y=F;this.L=c},Tno=function(v){var F,c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G;
return g.M(function(O){switch(O.B){case 1:if(v.C)throw Error("Already processing an action");if(v.Xs())return O.return();F=v.B.actions.shift();CcH(v.Bz,!F);if(F===void 0)return O.return();F.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&F.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&$SO(v.B,F.actionId);c="";F.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&F.rootActionId===F.actionId&&(c=F.actionId);S=[F];v.C=S;if(J=v.py[F.entityType]){O.A$(2);break}v.C=
void 0;return g.H(O,Tno(v),3);case 3:return O.return();case 2:A=g.k(S);for(C=A.next();!C.done;C=A.next())P=C.value,ifO(P,2);g.f1(O,4,5);return g.H(O,E2Y(J,S.map(function(a){return a.action})),7);
case 7:z=O.j,U=g.k(S),n=U.next();case 8:if(n.done){O.A$(10);break}r=n.value;h=z.get(r.action);return g.H(O,ySH(v,r,h),9);case 9:n=U.next();O.A$(8);break;case 10:$SO(v.B,c);case 5:g.d6(O);v.C=void 0;g.HY(O,6);break;case 4:return Q=g.Lf(O),m9("Orchestration error",Q),g.f1(O,12),g.H(O,nzf(v,S),14);case 14:g.Ek(O,5);break;case 12:u=g.Lf(O);m9("Orchestration retry error",u);D=g.k(S);for(w=D.next();!w.done;w=D.next())G=w.value,G.retryScheduleIndex<3&&aLz(v.B,[G]);O.A$(5);break;case 6:return g.H(O,Tno(v),
0)}})},b$=function(v,F,c,S){c=c===void 0?!1:c;
S=S===void 0?!0:S;F=typeof F==="string"?F:F.videoDetails.videoId;if(g.e1(F)===2){var J=Zfr(v,F);J&&J.stopVideo();g.L6(F,2);v.L=2;c?CDd(v.B):S&&a5d(v.B)}},U2o=function(v,F){if(F.length===0)return Promise.resolve([]);
F=F.map(function(c){return LK(c)});
return csd(v.j,F)},XPj=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w;
return g.M(function(G){switch(G.B){case 1:return c=Zg(F),S=g.Bx(F.entityKey),J=S.entityId,g.H(G,jb(v.B,F.entityKey,"musicTrack"),2);case 2:A=G.j;if(!A){C=void 0;G.A$(3);break}return g.H(G,jb(v.B,A.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:C=G.j;case 3:P=C;if(!A||!P)return G.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));U=g.x(F.actionMetadata,mgH);g.f1(G,5);return g.H(G,wbz(v,J,P.addedTimestampMillis,(n=U)==null?void 0:n.track,(r=U)==null?void 0:r.albumRelease),
7);case 7:Q=Number(((h=F.actionMetadata)==null?void 0:h.priority)||0)+1;z=qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"playbackData",Q,$gO);g.Ek(G,6);break;case 5:u=g.Lf(G);if(!(u instanceof Error&&u.message==="No data")){if(u instanceof Error&&u.message==="Empty response body")m9(u.message);else return D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.V$&&u.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),G.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,D,w));G.A$(6);break}return g.H(G,Jq(J,v.B,F,v.L),6);case 6:return G.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,z?[z]:void 0))}})},iQI=function(v){v=v*1E3-Date.now();
return v>4E3?4E3:v},vi=function(v,F,c,S,J){var A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6,dO,p7,Y,H_,PQ,yZ,ea;
return g.M(function(aO){switch(aO.B){case 1:return A=g.DB(v,F),C=g.DB("music_downloads_library_id","musicDownloadsLibraryEntity"),g.H(aO,gX(c,{mode:"readonly",cX:!0},function(B){return g.zo.all([sO(B,A,F),sO(B,C,"musicDownloadsLibraryEntity"),e2(B,F),e2(B,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:P=aO.j;z=g.k(P);U=z.next().value;n=z.next().value;r=z.next().value;h=z.next().value;Q=U;u=n;D=r;w=h;if(!Q){aO.A$(3);break}return g.H(aO,bwO(Q,D),4);case 4:return G=aO.j,g.H(aO,DA(G),3);case 3:O=[];a=new Map;if(!Q){aO.A$(6);break}return g.H(aO,gz7(Q,D,u),7);case 7:O=aO.j;T=g.k(O);for(m=T.next();!m.done;m=T.next())b=m.value,X=g.Bx(b).entityId,a.set(X,{videoId:X,playlistId:v,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.H(aO,tC(c,"transfer"),8);case 8:for(AJ=aO.j,C1=
g.k(AJ),c3=C1.next();!c3.done;c3=C1.next())n1=c3.value,FJ=g.Bx(n1.key).entityId,(xW=a.get(FJ))&&n1&&(xW.cotn=n1.cotn);case 6:tJ=[];zf=g.k(w);for(eY=zf.next();!eY.done;eY=zf.next())T6=eY.value,dO=g.Bx(T6.key).entityId,p7=xT(T6),dO!==v&&p7.rootActionId!==v||Wi(S,T6.actionProto)||tJ.push(T6.key);Y=g.DB(v,F);return g.H(aO,gX(c,{mode:"readwrite",cX:!0},function(B){var p=tJ.map(function(R1){return nK(B,R1)});
p.push(nK(B,Y,{nx:!0}));return g.zo.all(p)}),9);
case 9:if(!Q){aO.A$(0);break}O.reverse();if(!O.length){aO.A$(0);break}H_=g.k(O);PQ=H_.next();case 12:if(PQ.done){aO.A$(0);break}yZ=PQ.value;ea=g.Bx(yZ).entityId;if(!ea){aO.A$(13);break}return g.H(aO,Jq(ea,c,S,J,a.get(ea)),13);case 13:PQ=H_.next(),aO.A$(12)}})},ZD7=function(){HJ.apply(this,arguments)},vJO=function(v,F,c){F={offlineVideoData:F,
playlistId:c};if(v=g.x(v.actionMetadata,G3O))F.maximumDownloadQuality=v.maximumDownloadQuality;return{mainVideoEntityActionMetadata:F}},KL_=function(v){return g.M(function(F){if(F.B==1)return v.V?g.H(F,tq(v.W,v.V.videoDetails.videoId),3):F.A$(0);
d0(v);g.jo(F)})},lVr=function(v,F,c,S){if(v&&v.streamsProgress){S=v;
a:{F=F.itag+";"+F.xtags;for(var J=v.streamsProgress,A=0;A<J.length;A++){var C=JSON.parse(J[A].formatStreamBytes);if(C.itag+";"+C.xtags===F){J[A]=c;c=J;break a}}J.push(c);c=J}S.streamsProgress=c}else v={key:S,streamsProgress:[c]};return v},AEo=function(v){u$({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},v)},fT7=function(){if(F6)return F6();
var v={};F6=g.NP("PersistentEntityStoreDb",{OE:(v.EntityStore={LH:1},v.EntityAssociationStore={LH:2},v),shared:!1,upgrade:function(F,c){c(1)&&g.g2(g.qQ(F,"EntityStore",{keyPath:"key"}),"entityType","entityType");c(2)&&(F=g.qQ(F,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.g2(F,"byParentEntityKey","parentEntityKey"),g.g2(F,"byChildEntityKey","childEntityKey"))},
version:3});return F6()},Dad=function(v){return g2Z[v.transferState]!==void 0},qM7=function(){HJ.apply(this,arguments)},Pcd=function(v,F){v=v instanceof bH?v:F(v);
g.fM(v);throw v;},w0=function(v,F){if(v&&v.transferState!=="TRANSFER_STATE_COMPLETE"&&v.transferState!=="TRANSFER_STATE_FAILED"){var c=g.Bx(v.key).entityId;
u$({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:c,ZG:v,offlineModeType:F})}},IVr=function(v,F){var c,S,J,A,C,P,z,U,n,r,h,Q,u;
return g.M(function(D){switch(D.B){case 1:return c=Zg(F),S=g.Bx(F.entityKey),J=S.entityId,A=g.x(F.actionMetadata,mgH),g.f1(D,2),g.H(D,wbz(v,J,void 0,(C=A)==null?void 0:C.track,(P=A)==null?void 0:P.albumRelease),4);case 4:if((z=A)==null?0:z.playlistId){D.A$(5);break}return g.H(D,YgZ(v.B,F.entityKey),5);case 5:g.Ek(D,3);break;case 2:return U=g.Lf(D),n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.V$&&U.type==="QUOTA_EXCEEDED"&&
(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),D.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,n,r));case 3:Q=Number(((h=F.actionMetadata)==null?void 0:h.priority)||0)+1;var w=(w=g.x(F.actionMetadata,mgH))?{playbackDataActionMetadata:{maximumDownloadQuality:w.maximumDownloadQuality}}:void 0;u=qt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"playbackData",Q,$gO,w);return D.return(new K_("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c,[u]))}})},ePo=function(v,F,c,S){var J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6;
return g.M(function(dO){switch(dO.B){case 1:return g.H(dO,a8(),2);case 2:J=dO.j;if(!J)return dO.return([]);A=[];if((C=S)==null?0:C.length){A=S;dO.A$(3);break}return g.H(dO,tC(J,"musicPlaylist"),4);case 4:A=dO.j;case 3:if(!A.length)return dO.return([]);P=[];z=Date.now()/1E3;U=g.k(A);n=U.next();case 5:if(n.done)return P.length?g.H(dO,lLH(P),10):dO.return([]);r=n.value;h=void 0;u=(Q=(h=r)==null?void 0:h.entityMetadata)&&Q.nextAutoRefreshIntervalSeconds?Number(Q.nextAutoRefreshIntervalSeconds):NaN;D=
Number.isNaN(u)?v:u;G=w=0;O="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!r.downloadMetadata){dO.A$(8);break}return g.H(dO,jb(J,r.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:a=dO.j,m=T=void 0,w=Number((m=(T=a)==null?void 0:T.addedTimestampMillis)!=null?m:"0")/1E3,X=b=void 0,G=Number((X=(b=a)==null?void 0:b.lastModifiedTimestampMillis)!=null?X:"0")/1E3,C1=AJ=void 0,O=(C1=(AJ=a)==null?void 0:AJ.syncState)!=null?C1:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:c3=void 0;if(c||O!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!Q||Number((c3=Q.lastSyncedTimestampSeconds)!=null?c3:0)+D<=z){n1=[];FJ=void 0;if((FJ=r.tracks)==null?0:FJ.length)for(xW=g.k(r.tracks),tJ=xW.next();!tJ.done;tJ=xW.next())zf=tJ.value,n1.push(g.Bx(zf).entityId);eY={playlistId:r.playlistId,videoIds:n1,offlineLastModifiedTimestamp:String(G.toFixed()),autoSync:F,offlineDateAddedTimestamp:String(w.toFixed())};P.push(eY)}n=U.next();dO.A$(5);break;case 10:return T6=dO.j,dO.return(T6)}})},gvr=function(){HJ.apply(this,arguments)},g0=function(v,F){F=F===void 0?
!1:F;
var c;return g.M(function(S){if(S.B==1){if(v.B)throw Error("Already downloading a video");v.Bz=0;v.G=!1;return g.H(S,xaj(v),2)}return S.B!=4?(c=S.j,wrz(v.Ky,!c),c&&v.K.xU()?F?g.H(S,new Promise(function(J){g.$W(J,1E3)}),4):S.A$(4):(!c&&v.B&&d0(v),S.A$(0))):g.H(S,Zwf(v,c),0)})},yEI=function(){HJ.apply(this,arguments)},jl7=function(v,F){return v.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(F))},zV=function(v,F){v.api.jD("woffle",{mcte:F});
m9("missing current transfer entity.")},ecZ=function(v,F,c){var S,J,A;
return g.M(function(C){switch(C.B){case 1:return g.H(C,IKI([F]),2);case 2:return S=C.j,g.H(C,d2H(v,S[0],c),3);case 3:return J=C.j,A=Aq(J.thumbnailDetails),g.H(C,CK(A),4);case 4:return C.return(S[0].videos)}})},bDO=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!v.entityKey},PLd=function(v,F,c,S){var J,A,C;
return g.M(function(P){switch(P.B){case 1:return g.H(P,IKI([F]),2);case 2:return J=P.j,g.H(P,ZQ7(v,J[0],c,S),3);case 3:return A=P.j,C=Aq(A.thumbnailDetails),g.H(P,CK(C),4);case 4:return P.return(J[0].videos)}})};
g.RK.prototype.O6=g.hP(45,function(v){return this.app.O6(v)});
g.my.prototype.O6=g.hP(44,function(v){return g.kta(this,9,v)});
g.d(HJ,Mt);g.jy.Object.defineProperties(HJ.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.B.entityMetadata},
set:function(v){this.B.entityMetadata=v}}});
g.d(ttr,HJ);ttr.prototype.j=function(){return[]};
g.d(vzt,HJ);vzt.prototype.j=function(){return[]};
g.d(GQf,HJ);GQf.prototype.j=function(){return[]};
g.d(t_H,HJ);t_H.prototype.j=function(){return[]};
g.d(xg_,HJ);xg_.prototype.j=function(){return[]};
g.d(Ts7,HJ);Ts7.prototype.j=function(){var v=[];this.B.alternateChannel&&v.push(this.B.alternateChannel);this.B.alternateChannelList&&v.push.apply(v,g.ZQ(this.B.alternateChannelList));this.B.oneofChannelEntity&&v.push(this.B.oneofChannelEntity);return[].concat(g.ZQ(new Set(v)))};
g.d(RPj,HJ);RPj.prototype.j=function(){var v=[];this.B.entryCollection&&v.push(this.B.entryCollection);return[].concat(g.ZQ(new Set(v)))};
g.d(zc7,Mt);zc7.prototype.j=function(){var v=[];this.B.video&&v.push(this.B.video);return[].concat(g.ZQ(new Set(v)))};
g.d(VHt,HJ);VHt.prototype.j=function(){var v=[];this.B.parentPlaylist&&v.push(this.B.parentPlaylist);if(this.B.entries)for(var F=g.k(this.B.entries),c=F.next();!c.done;c=F.next())v.push.apply(v,g.ZQ((new zc7(c.value)).j()));return[].concat(g.ZQ(new Set(v)))};
g.d(Mk7,HJ);Mk7.prototype.j=function(){var v=[];this.B.descriptionEntity&&v.push(this.B.descriptionEntity);this.B.creators&&v.push.apply(v,g.ZQ(this.B.creators));this.B.theBiggestFan&&v.push(this.B.theBiggestFan);return[].concat(g.ZQ(new Set(v)))};
g.d(Tyr,HJ);Tyr.prototype.j=function(){return[]};
g.d(U5_,HJ);U5_.prototype.j=function(){return[]};
g.d(iDz,HJ);iDz.prototype.j=function(){return[]};
g.d(fh_,HJ);fh_.prototype.j=function(){return[]};
g.d(qlH,HJ);qlH.prototype.j=function(){return[]};
g.d(oNo,HJ);oNo.prototype.j=function(){return[]};
g.d(M4z,HJ);M4z.prototype.j=function(){return[]};
g.d(oz7,HJ);oz7.prototype.j=function(){return[]};
g.d(Yyo,HJ);Yyo.prototype.j=function(){return[]};
g.d(kdY,HJ);kdY.prototype.j=function(){var v=[];this.B.downloadsList&&v.push(this.B.downloadsList);this.B.smartDownloadsList&&v.push(this.B.smartDownloadsList);this.B.recommendedDownloadsList&&v.push(this.B.recommendedDownloadsList);this.B.refresh&&v.push(this.B.refresh);return[].concat(g.ZQ(new Set(v)))};
g.d(ov7,Mt);ov7.prototype.j=function(){var v=[];this.B.video&&v.push(this.B.video);this.B.playlist&&v.push(this.B.playlist);this.B.videoItem&&v.push(this.B.videoItem);this.B.playlistItem&&v.push(this.B.playlistItem);return[].concat(g.ZQ(new Set(v)))};
g.d(pzH,HJ);pzH.prototype.j=function(){var v=[];this.B.refresh&&v.push(this.B.refresh);if(this.B.downloads)for(var F=g.k(this.B.downloads),c=F.next();!c.done;c=F.next())v.push.apply(v,g.ZQ((new ov7(c.value)).j()));return[].concat(g.ZQ(new Set(v)))};
g.d(M_r,HJ);M_r.prototype.j=function(){var v=[];this.B.localImageEntities&&v.push.apply(v,g.ZQ(this.B.localImageEntities));return[].concat(g.ZQ(new Set(v)))};
g.d(dgr,HJ);dgr.prototype.j=function(){var v=[];this.B.playbackData&&v.push(this.B.playbackData);this.B.localImageEntities&&v.push.apply(v,g.ZQ(this.B.localImageEntities));this.B.videoDownloadContextEntity&&v.push(this.B.videoDownloadContextEntity);return[].concat(g.ZQ(new Set(v)))};
g.d(HM7,HJ);HM7.prototype.j=function(){return[]};
g.d(uaY,HJ);uaY.prototype.j=function(){var v=[];this.B.fakeChildren&&v.push.apply(v,g.ZQ(this.B.fakeChildren));return[].concat(g.ZQ(new Set(v)))};
g.d(Rnj,HJ);Rnj.prototype.j=function(){var v=[];this.B.video&&v.push(this.B.video);this.B.playbackData&&v.push(this.B.playbackData);this.B.offlineVideoPolicy&&v.push(this.B.offlineVideoPolicy);return[].concat(g.ZQ(new Set(v)))};
g.d(jWz,HJ);jWz.prototype.j=function(){return[]};
g.d(CMt,HJ);CMt.prototype.j=function(){var v=[];this.B.channelOwner&&v.push(this.B.channelOwner);this.B.videos&&v.push.apply(v,g.ZQ(this.B.videos));this.B.collaboratorChannels&&v.push.apply(v,g.ZQ(this.B.collaboratorChannels));this.B.downloadState&&v.push(this.B.downloadState);this.B.refresh&&v.push(this.B.refresh);return[].concat(g.ZQ(new Set(v)))};
g.d(qBj,HJ);qBj.prototype.j=function(){var v=[];this.B.video&&v.push(this.B.video);this.B.channelContributor&&v.push(this.B.channelContributor);return[].concat(g.ZQ(new Set(v)))};
g.d(Hc7,Mt);Hc7.prototype.j=function(){var v=[];this.B.localImageEntities&&v.push.apply(v,g.ZQ(this.B.localImageEntities));this.B.videoDownloadContextEntity&&v.push(this.B.videoDownloadContextEntity);return[].concat(g.ZQ(new Set(v)))};
g.d(v2O,Mt);v2O.prototype.j=function(){var v=[];this.B.recommendedVideoMetadata&&v.push.apply(v,g.ZQ((new Hc7(this.B.recommendedVideoMetadata)).j()));return[].concat(g.ZQ(new Set(v)))};
g.d(aTI,Mt);aTI.prototype.j=function(){var v=[];this.B.playbackPosition&&v.push(this.B.playbackPosition);return[].concat(g.ZQ(new Set(v)))};
g.d(XA7,HJ);XA7.prototype.j=function(){var v=[];this.B.owner&&v.push(this.B.owner);this.B.downloadState&&v.push(this.B.downloadState);this.B.userState&&v.push.apply(v,g.ZQ((new aTI(this.B.userState)).j()));this.B.additionalMetadata&&v.push.apply(v,g.ZQ((new v2O(this.B.additionalMetadata)).j()));return[].concat(g.ZQ(new Set(v)))};
g.d(oJY,HJ);oJY.prototype.j=function(){var v=[];this.B.userChannelDetails&&v.push(this.B.userChannelDetails);return[].concat(g.ZQ(new Set(v)))};
g.d(ZMZ,HJ);ZMZ.prototype.j=function(){var v=[];this.B.channelOwner&&v.push(this.B.channelOwner);this.B.playbackPosition&&v.push(this.B.playbackPosition);this.B.localImageEntities&&v.push.apply(v,g.ZQ(this.B.localImageEntities));this.B.downloadStatus&&v.push(this.B.downloadStatus);return[].concat(g.ZQ(new Set(v)))};
g.d(XrO,HJ);XrO.prototype.j=function(){return[]};
g.d(yV7,HJ);yV7.prototype.j=function(){return[]};
g.d(wd7,HJ);wd7.prototype.j=function(){return[]};
g.d(nJj,HJ);nJj.prototype.j=function(){return[]};
g.d(maY,HJ);maY.prototype.j=function(){return[]};
g.d(ZD7,HJ);ZD7.prototype.j=function(){return[]};
g.d(k5_,HJ);k5_.prototype.j=function(){return[]};
g.d(z_7,HJ);z_7.prototype.j=function(){return[]};
g.d(d5r,HJ);d5r.prototype.j=function(){return[]};
g.d(mSo,HJ);mSo.prototype.j=function(){return[]};
g.d(QLj,HJ);QLj.prototype.j=function(){return[]};
g.d(Gd_,HJ);Gd_.prototype.j=function(){return[]};
g.d(Ezj,HJ);Ezj.prototype.j=function(){return[]};
g.d(bQo,HJ);bQo.prototype.j=function(){var v=[];this.B.compositeSourceKeys&&v.push.apply(v,g.ZQ(this.B.compositeSourceKeys));return[].concat(g.ZQ(new Set(v)))};
g.d(qM7,HJ);qM7.prototype.j=function(){var v=[];this.B.trackDownloadMetadatas&&v.push.apply(v,g.ZQ(this.B.trackDownloadMetadatas));return[].concat(g.ZQ(new Set(v)))};
g.d(fL7,HJ);
fL7.prototype.j=function(){var v=[];this.B.downloadedTracks&&v.push.apply(v,g.ZQ(this.B.downloadedTracks));this.B.smartDownloadedTracks&&v.push.apply(v,g.ZQ(this.B.smartDownloadedTracks));this.B.downloadedEpisodes&&v.push.apply(v,g.ZQ(this.B.downloadedEpisodes));this.B.downloadedAlbumReleases&&v.push.apply(v,g.ZQ(this.B.downloadedAlbumReleases));this.B.smartDownloadedAlbumReleases&&v.push.apply(v,g.ZQ(this.B.smartDownloadedAlbumReleases));this.B.downloadedPlaylists&&v.push.apply(v,g.ZQ(this.B.downloadedPlaylists));this.B.smartDownloadedPlaylists&&
v.push.apply(v,g.ZQ(this.B.smartDownloadedPlaylists));this.B.metadataOnlyTracks&&v.push.apply(v,g.ZQ(this.B.metadataOnlyTracks));return[].concat(g.ZQ(new Set(v)))};
g.d(enj,HJ);enj.prototype.j=function(){var v=[];this.B.trackDownloadMetadatas&&v.push.apply(v,g.ZQ(this.B.trackDownloadMetadatas));return[].concat(g.ZQ(new Set(v)))};
g.d(Vm7,HJ);Vm7.prototype.j=function(){var v=[];this.B.playbackData&&v.push(this.B.playbackData);this.B.localImageEntities&&v.push.apply(v,g.ZQ(this.B.localImageEntities));this.B.videoDownloadContextEntity&&v.push(this.B.videoDownloadContextEntity);return[].concat(g.ZQ(new Set(v)))};
g.d(nSd,HJ);nSd.prototype.j=function(){var v=[];this.B.musicLibraryStatusEntity&&v.push(this.B.musicLibraryStatusEntity);this.B.primaryArtists&&v.push.apply(v,g.ZQ(this.B.primaryArtists));this.B.details&&v.push(this.B.details);this.B.userDetails&&v.push(this.B.userDetails);this.B.tracks&&v.push.apply(v,g.ZQ(this.B.tracks));this.B.share&&v.push(this.B.share);this.B.downloadMetadata&&v.push(this.B.downloadMetadata);this.B.refresh&&v.push(this.B.refresh);return[].concat(g.ZQ(new Set(v)))};
g.d(EJ7,HJ);EJ7.prototype.j=function(){var v=[];this.B.albumRelease&&v.push(this.B.albumRelease);this.B.tracks&&v.push.apply(v,g.ZQ(this.B.tracks));return[].concat(g.ZQ(new Set(v)))};
g.d(Qlr,HJ);Qlr.prototype.j=function(){var v=[];this.B.albumRelease&&v.push(this.B.albumRelease);return[].concat(g.ZQ(new Set(v)))};
g.d(hnY,HJ);hnY.prototype.j=function(){var v=[];this.B.details&&v.push(this.B.details);this.B.userDetails&&v.push(this.B.userDetails);return[].concat(g.ZQ(new Set(v)))};
g.d(y0H,HJ);y0H.prototype.j=function(){var v=[];this.B.parentArtist&&v.push(this.B.parentArtist);return[].concat(g.ZQ(new Set(v)))};
g.d(olr,HJ);olr.prototype.j=function(){var v=[];this.B.parentArtist&&v.push(this.B.parentArtist);return[].concat(g.ZQ(new Set(v)))};
g.d(zbd,HJ);zbd.prototype.j=function(){return[]};
g.d(SMz,HJ);SMz.prototype.j=function(){return[]};
g.d(Pp7,Mt);Pp7.prototype.j=function(){var v=[];this.B.creatorEntity&&v.push(this.B.creatorEntity);return[].concat(g.ZQ(new Set(v)))};
g.d(I5I,HJ);
I5I.prototype.j=function(){var v=[];this.B.tracks&&v.push.apply(v,g.ZQ(this.B.tracks));this.B.refresh&&v.push(this.B.refresh);this.B.musicLibraryStatusEntity&&v.push(this.B.musicLibraryStatusEntity);this.B.details&&v.push(this.B.details);this.B.downloadMetadata&&v.push(this.B.downloadMetadata);this.B.sideloadMetadata&&v.push(this.B.sideloadMetadata);this.B.userDetails&&v.push(this.B.userDetails);this.B.entryCollection&&v.push(this.B.entryCollection);this.B.share&&v.push(this.B.share);this.B.podcastShowAdditionalMetadata&&
v.push.apply(v,g.ZQ((new Pp7(this.B.podcastShowAdditionalMetadata)).j()));return[].concat(g.ZQ(new Set(v)))};
g.d(Kvt,HJ);Kvt.prototype.j=function(){return[]};
g.d(yEI,HJ);
yEI.prototype.j=function(){var v=[];this.B.musicLibraryStatusEntity&&v.push(this.B.musicLibraryStatusEntity);this.B.artists&&v.push.apply(v,g.ZQ(this.B.artists));this.B.audioModeVersion&&v.push(this.B.audioModeVersion);this.B.videoModeVersion&&v.push(this.B.videoModeVersion);this.B.userDetails&&v.push(this.B.userDetails);this.B.details&&v.push(this.B.details);this.B.albumRelease&&v.push(this.B.albumRelease);this.B.share&&v.push(this.B.share);this.B.libraryEdit&&v.push(this.B.libraryEdit);this.B.downloadMetadata&&
v.push(this.B.downloadMetadata);this.B.playbackPosition&&v.push(this.B.playbackPosition);this.B.lyrics&&v.push(this.B.lyrics);return[].concat(g.ZQ(new Set(v)))};
g.d(icd,HJ);icd.prototype.j=function(){var v=[];this.B.parentTrack&&v.push(this.B.parentTrack);return[].concat(g.ZQ(new Set(v)))};
g.d(H3O,HJ);H3O.prototype.j=function(){var v=[];this.B.parentTrack&&v.push(this.B.parentTrack);return[].concat(g.ZQ(new Set(v)))};
g.d(h_t,HJ);h_t.prototype.j=function(){return[]};
g.d(wP7,HJ);wP7.prototype.j=function(){return[]};
g.d(Elj,HJ);Elj.prototype.j=function(){return[]};
g.d(PDo,HJ);PDo.prototype.j=function(){return[]};
g.d(jG_,HJ);jG_.prototype.j=function(){var v=[];this.B.transfer&&v.push(this.B.transfer);this.B.adsPlaybackData&&v.push.apply(v,g.ZQ(this.B.adsPlaybackData));this.B.drmLicense&&v.push(this.B.drmLicense);this.B.offlineVideoPolicy&&v.push(this.B.offlineVideoPolicy);this.B.videoDownloadContextEntity&&v.push(this.B.videoDownloadContextEntity);return[].concat(g.ZQ(new Set(v)))};
g.d(Byj,HJ);Byj.prototype.j=function(){return[]};
g.d(cSI,HJ);cSI.prototype.j=function(){var v=[];this.B.offlineVideoStreams&&v.push.apply(v,g.ZQ(this.B.offlineVideoStreams));this.B.captionTrack&&v.push.apply(v,g.ZQ(this.B.captionTrack));return[].concat(g.ZQ(new Set(v)))};
g.d(AsY,HJ);AsY.prototype.j=function(){return[]};
g.d(vvj,HJ);vvj.prototype.j=function(){return[]};
g.d(XbH,HJ);XbH.prototype.j=function(){return[]};
g.d(Gr7,HJ);Gr7.prototype.j=function(){return[]};
g.d(L_o,HJ);L_o.prototype.j=function(){return[]};
g.d(sGj,HJ);sGj.prototype.j=function(){return[]};
g.d(O37,HJ);O37.prototype.j=function(){return[]};
g.d(yY7,HJ);yY7.prototype.j=function(){return[]};
g.d($5d,HJ);$5d.prototype.j=function(){return[]};
g.d($Bj,HJ);$Bj.prototype.j=function(){return[]};
g.d(e_r,HJ);e_r.prototype.j=function(){return[]};
g.d(lhd,HJ);lhd.prototype.j=function(){return[]};
g.d(gvr,HJ);gvr.prototype.j=function(){return[]};
g.d(tm7,HJ);tm7.prototype.j=function(){return[]};
g.d(nvI,HJ);nvI.prototype.j=function(){return[]};
g.d(m5Z,HJ);m5Z.prototype.j=function(){return[]};
g.d(ILo,HJ);ILo.prototype.j=function(){return[]};
g.d(Cp7,HJ);Cp7.prototype.j=function(){return[]};
g.d(kr_,HJ);kr_.prototype.j=function(){return[]};
g.d(mBf,HJ);mBf.prototype.j=function(){return[]};
g.d(I1j,HJ);I1j.prototype.j=function(){return[]};
g.d(rEz,HJ);rEz.prototype.j=function(){return[]};
var Zcd=["browse","music/browse","unplugged/browse"],OQO=["offline/playlist_sync_check"],qnj=["offline"],L27=["offline/offline_video_playback_position_sync"],TFd=["offline/get_playback_data_entity"],F6;Hi.getInstance=function(){return g.M(function(v){return v.return(new Promise(function(F){g.Lc().then(function(c){c?(Hi.instance||(Hi.instance=new Hi(c)),F(Hi.instance)):F(void 0)})}))})};
Hi.prototype.get=function(v){var F=this,c,S,J;return g.M(function(A){if(A.B==1)return g.H(A,gNd(F.token),2);if(A.B!=3)return c=A.j,g.H(A,c.get("prefs",v),3);S=A.j;if(!S)return A.return();J=(0,g.f9)();return S.expirationTimestampMs<=J?A.return():A.return(S.value)})};
Hi.prototype.set=function(v,F,c){c=c===void 0?31536E3:c;var S=this,J,A,C;return g.M(function(P){if(P.B==1)return J=(0,g.f9)(),A={key:v,value:F,expirationTimestampMs:J+c*1E3},g.H(P,gNd(S.token),2);C=P.j;return g.H(P,g.GN(C,"prefs",A),0)})};
Hi.prototype.remove=function(v){var F=this,c;return g.M(function(S){if(S.B==1)return g.H(S,gNd(F.token),2);c=S.j;return g.H(S,c.delete("prefs",v),0)})};
g.d(bH,g.VS);g.d(EO,xxZ);EO.prototype.L=function(v,F){F=Nsf(F);v=(new TextEncoder).encode(JSON.stringify(v));return this.B.encrypt(v,F)};
EO.prototype.j=function(v,F){if(!(v instanceof Uint8Array))throw b37(1);var c=new TextDecoder;F=Nsf(F);v=this.B.decrypt(v,F);return JSON.parse(c.decode(v))};
var qgr={accountLinkStatusEntity:iDz,booleanEntity:t_H,buttonEntity:nvI,captionTrack:h_t,channelHandle:ttr,chipEntity:O37,commerceAcquisitionClientPayloadEntity:ILo,commerceCartListEntity:Cp7,compositeSourceEntity:Ezj,multiviewStagingEntity:bQo,contextNoteFeedEntityPayload:vzt,contextNoteUserRatingEntityPayload:GQf,continuationTokenEntity:jWz,downloadQualityPickerEntity:M4z,downloadsPageRefreshTokenEntity:Yyo,downloadsPageViewConfigurationEntity:XrO,downloadStatusEntity:oz7,dismissState:yY7,sfvAudioItemCurrentlyPlayingEntity:Gr7,
emojiFountainDataEntity:gvr,emojiCustomizationSetEntity:lhd,fakeChannel:Ts7,fakePlaylist:RPj,fakePlaylistEntryCollection:VHt,fakeVideo:Mk7,fakeVideoDescription:Tyr,featuredProductsEntity:mSo,flowStateEntity:U5_,iconBadgeEntity:kr_,interstitialInteractionStateEntity:qlH,likeButtonAnimationEntity:yV7,liveChatPollStateEntity:oNo,dataFreshnessEntity:e_r,liveViewerLeaderboardChatEntryPointStateEntity:vvj,liveViewerLeaderboardPointsEntity:XbH,liveReactionsDataEntity:tm7,logoEntity:fh_,macroMarkerEntity:wd7,
mainDownloadsLibraryEntity:kdY,mainDownloadsListEntity:pzH,mainPlaylistDownloadStateEntity:M_r,mainPlaylistEntity:CMt,mainPlaylistVideoEntity:qBj,mainVideoDownloadStateEntity:dgr,mainVideoEntity:XA7,markersEngagementPanelSyncEntity:nJj,markersVisibilityOverrideEntity:maY,musicAlbumReleaseDetail:EJ7,musicAlbumReleaseDownloadMetadataEntity:qM7,musicAlbumRelease:nSd,musicAlbumReleaseUserDetail:Qlr,musicArtistDetail:y0H,musicArtist:hnY,musicArtistUserDetail:olr,musicDownloadsLibraryEntity:fL7,musicLibraryEdit:zbd,
musicLibraryStatusEntity:SMz,musicPlaylist:I5I,musicPlaylistDownloadMetadataEntity:enj,musicShare:Kvt,musicTrackDetail:icd,musicTrackDownloadMetadataEntity:Vm7,musicTrack:yEI,musicTrackUserDetail:H3O,offlineOrchestrationActionWrapperEntity:wP7,offlineVideoPolicy:Elj,offlineVideoStreams:PDo,offlineabilityEntity:HM7,orchestrationWebSamplingEntity:uaY,pageHeaderEntity:$5d,pdpStateEntity:mBf,pinnedProductEntity:QLj,playbackData:jG_,playerStateEntity:ZD7,quantityIncrementerEntity:I1j,refresh:Byj,saveToPlaylistListEntity:L_o,
selectedChipIndexEntityPayload:k5_,settingEntity:sGj,stringEntity:xg_,suggestedFeedbackChipStateEntity:z_7,transfer:cSI,trendingOfferEntity:Gd_,videoDownloadContextEntity:AsY,videoOverviewAsyncDataEntity:rEz,videoPlaybackPositionEntity:m5Z,votingEntity:$Bj,ytMainChannelEntity:oJY,youchatPendingResponseEntity:d5r,ytMainDownloadedVideoEntity:Rnj,ytMainVideoEntity:ZMZ};g.d(X8,xxZ);X8.prototype.L=function(v){return v};
X8.prototype.j=function(v){if(v instanceof Uint8Array)throw b37(0);return v};
g.d(ZA,g.q);ZA.prototype.observe=function(v){var F=this;this.observers.push(v);return function(){var c=F.observers.indexOf(v);c>=0&&F.observers.splice(c,1)}};
ZA.prototype.j=function(v){hcf(this,v.data)};
ZA.prototype.Ly=function(){this.channel.close()};
var Of7,G5H=new g.LS("elementsCommand");var S2=new g.LS("entityBatchUpdate");var PCI=new g.LS("downloadStatusEntity");var G3O=new g.LS("mainPlaylistEntityActionMetadata");var i$=new g.LS("mainVideoEntityActionMetadata");var CLo=new g.LS("musicPlaylistEntityActionMetadata");var mgH=new g.LS("musicTrackEntityActionMetadata");var Lv7=new g.LS("localImageEntityActionMetadata");var l$=new g.LS("playbackDataActionMetadata");var vS7=new g.LS("transferEntityActionMetadata");var cEd=new g.LS("videoPlaybackPositionEntityActionMetadata");var UBf;new g.jL;new g.jL;xBH.prototype.request=function(v,F,c){F=F===void 0?{}:F;return this.locks.request(v,F,function(S){return c(S)})};var j2=g.C7.caches,Vx,Vto;qA.prototype.open=function(v){return j2.open(pdr(v))};
qA.prototype.has=function(v){return j2.has(pdr(v))};
qA.prototype.delete=function(v){return j2.delete(pdr(v))};
qA.prototype.match=function(v,F){var c=this,S,J,A,C,P,z;return g.M(function(U){switch(U.B){case 1:return g.H(U,c.keys(),2);case 2:S=U.j,J=g.k(S),A=J.next();case 3:if(A.done){U.A$(5);break}C=A.value;return g.H(U,c.open(C),6);case 6:return P=U.j,g.H(U,P.match(v,F),7);case 7:if(z=U.j)return U.return(z);A=J.next();U.A$(3);break;case 5:return U.return()}})};
g.d(BnI,qA);BnI.prototype.keys=function(){var v,F,c,S,J,A,C,P,z;return g.M(function(U){if(U.B==1)return v=[],F=g.tb("CacheStorage keys"),g.H(U,j2.keys(),2);c=U.j;S=g.k(c);for(J=S.next();!J.done;J=S.next()){A=J.value;var n=A.indexOf(":");C=n===-1?{QP:A}:{QP:A.substring(0,n),datasyncId:A.substring(n+1)};P=C.QP;z=C.datasyncId;z===F&&v.push(P)}return U.return(v)})};g.d(VX,g.q);VX.prototype.L=function(v){this.api.rS("onOfflineOperationFailure",v.data)};
VX.prototype.C=function(v){this.api.publish("offlinetransferpause",v.data)};
VX.prototype.Ly=function(){var v;(v=this.B)==null||v.close();var F;(F=this.j)==null||F.close()};Syd.prototype.DM=function(){this.B&&MA(this)};
Syd.prototype.Cp=function(){this.j&&this.j.resolve();this.L=this.B=!1;this.bX()};var D2_=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var SBI="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var LLI="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.d(Ny7,I8);Ny7.prototype.j=function(v){return m5(v)?Bo7(this,v):pK(v)?Ylr(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.d(mxZ,I8);mxZ.prototype.j=function(v){return pK(v)?aV7(this,v):bDO(v)?sLf(this,v):vL(v)?SI_(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.N=js_.prototype;g.N.imS=function(v){var F=this,c,S,J,A;return g.M(function(C){if(!g.y(v.state,128))return C.A$(0);c=v.state.Is;var P=(S=c)==null?void 0:S.errorCode,z=(J=c)==null?void 0:J.eJ;A=P==="net.connect"&&z===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(P==null?0:P.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.H(C,F.mN(F.player.getVideoData().videoId,A),0)})};
g.N.mN=function(v,F){var c=this;return g.M(function(S){if(S.B==1){if(c.j)return S.return();c.j=!0;return F==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(b$(c,v,!1,!0),S.A$(0)):g.H(S,tq(c,v),3)}g.L6(v,4);return g.H(S,c.B.mN(F),0)})};
g.N.G8=function(v){v.status===2?(v.status!==this.L&&(UaH(this.B),g.L6(v.videoId,2)),v.W4&&EvO(this.B,v.videoId,v.W4)):v.status===4?(tq(this,v.videoId),this.mN(v.videoId,v.LF?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):v.status===1&&V_I(this.B);this.L=v.status;this.api.rS("localmediachange",{videoId:v.videoId,status:v.status})};
g.N.yf=function(){var v=this,F;return g.M(function(c){if(c.B==1){if(v.j)return c.return();v.j=!0;F=v.player.getVideoData().videoId;return g.H(c,tq(v,F),2)}return g.H(c,v.B.yf(),0)})};
g.N.aG=function(v){switch(v){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.N.D=function(v){return this.api.S().D(v)};g.d(k3d,I8);k3d.prototype.j=function(v){return m5(v)?Qsz(this,v):pK(v)?eEo(this,v):bDO(v)?WLd(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};jZZ.prototype.B=function(v,F){var c=v.action.actionMetadata.priority-F.action.actionMetadata.priority;c===0&&(v.B<F.B?c=-1:v.B>F.B&&(c=1));return c};g.d(KK,g.q);KK.prototype.Ly=function(){this.bX&&this.bX();g.q.prototype.Ly.call(this)};
KK.prototype.createAction=function(v,F){var c=g.Bx(v.entityKey).entityType,S=g.gg(16);return new TV(c,S,v,F.actionId,F.rootActionId)};
KK.prototype.Mk=function(v){var F=this,c,S,J,A,C,P,z,U,n;return g.M(function(r){if(r.B==1){if(F.Xs())return r.return();S=(c=v.offlineOrchestrationActionWrapperEntity)!=null?c:new Set;J=[];A=g.k(S);for(C=A.next();!C.done;C=A.next())P=C.value,z=g.Bx(P),U=z.entityId,Ihz(F.B,U)||J.push(P);return g.H(r,K2Y(F,J),2)}n=r.j;return g.H(r,W_O(F,n),0)})};
KK.prototype.retry=function(){var v=this;return g.M(function(F){return g.H(F,T$f(v),0)})};YI7.prototype.Gh=function(v,F){F=F===void 0?!0:F;var c=this,S,J,A,C,P,z,U,n;return g.M(function(r){switch(r.B){case 1:if(!c.B)return r.return();S=[];J=g.q0(c.B.j,F);A=[];for(C={oS:0};C.oS<J.length;C={oS:C.oS},C.oS++)P=J[C.oS],z=c.B.iS(P,"json3"),U=g.A3(z,{withCredentials:!0,format:"RAW"},3,500).then(function(h){return function(Q){Q={metadata:g.GE(J[h.oS]),trackData:Q.xhr.responseText};A.push(Q)}}(C)).gM(function(h){m9("Caption fetch error",h)}),S.push(U);
return g.H(r,kQr(S),2);case 2:return g.f1(r,3),g.H(r,MmO(v,A),5);case 5:g.Ek(r,0);break;case 3:n=g.Lf(r),m9("Caption DB transaction error",n),g.jo(r)}})};g.d($T,g.q);$T.prototype.Ly=function(){this.j&&this.j();g.q.prototype.Ly.call(this)};
$T.prototype.L=function(v){var F=this,c,S,J,A,C,P,z,U;return g.M(function(n){S=(c=v.transfer)!=null?c:new Set;J=[];A=g.k(S);for(C=A.next();!C.done;C=A.next())P=C.value,z=g.Bx(P),U=z.entityId,J.push(U);return J.length===0?n.return():g.H(n,Hwf(F,J),0)})};g.d(sWf,g.q);g.N=sWf.prototype;g.N.Ly=function(){this.py&&this.py();this.h$.dispose();this.C.dispose();this.Ub&&g.ZY(this.K.xT,this.Ub);this.zc&&g.ZY(this.K.xT,this.zc);g.q.prototype.Ly.call(this)};
g.N.w_5=function(v){var F=this,c,S,J;return g.M(function(A){switch(A.B){case 1:c=g.DB(v,"transfer");if(F.B&&c===F.B.key){b$(F.W,F.V,!0);F.C.stop();A.A$(0);break}return g.H(A,gX(F.j,{mode:"readwrite",cX:!0},function(C){return sO(C,c,"transfer").then(function(P){if(P&&P.transferState!=="TRANSFER_STATE_COMPLETE"&&P.transferState!=="TRANSFER_STATE_FAILED")return P.transferState="TRANSFER_STATE_PAUSED_BY_USER",yX(C,P,"transfer").then(function(){return P})})}),3);
case 3:S=A.j;if(!S){A.A$(0);break}if(!v||!F.L){A.A$(5);break}return g.H(A,Pi(v,F.L,F.j,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.H(A,Qx(F,v),7);case 7:J=A.j,AEo({videoId:v,ZG:S,offlineModeType:J}),g.jo(A)}})};
g.N.h85=function(){var v=this;if(this.B&&this.V){b$(this.W,this.V,!1);var F=this.B,c=(F==null?0:F.key)?g.Bx(F.key).entityId:"";c&&this.L&&(new Promise(function(S,J){Pi(c,v.L,v.j,"DOWNLOAD_STATE_PAUSED").catch(function(A){J(A)})})).catch(function(S){m9("Download state setting error",S)})}this.C.stop()};
g.N.x8=function(){this.B?Zwf(this,this.B):g0(this)};
g.N.W2=function(v){var F=this;return g.M(function(c){switch(c.B){case 1:if(!F.B){c.A$(2);break}if(F.B.transferState==="TRANSFER_STATE_COMPLETE"||F.B.transferState==="TRANSFER_STATE_FAILED"||!v.transfer||!v.transfer.has(F.B.key)){c.A$(3);break}return g.H(c,jb(F.j,F.B.key,"transfer"),4);case 4:F.B=c.j;if(F.B){c.A$(3);break}return g.H(c,KL_(F),3);case 3:if(F.B)return c.return();case 2:return g.H(c,g0(F),0)}})};
g.N.mN=function(v,F){var c=this,S,J,A,C,P;return g.M(function(z){switch(z.B){case 1:if(!c.B){zV(c,"onTransferFailure: "+v);z.A$(2);break}S=c.B;A=((J=S)==null?0:J.key)?g.Bx(S.key).entityId:"";a:switch(v){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var U=!1;break a;default:U=!0}return U&&m2o(c)?g.H(z,UO(c,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.H(z,
pb7(c,v),5);case 5:if(!A||!c.L){z.A$(2);break}return g.H(z,Pi(A,c.L,c.j,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.H(z,Qx(c,A),9);case 9:C=z.j;u$({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:A,ZG:S,offlineModeType:C});if(!A||!c.L){z.A$(2);break}return g.H(z,Pi(A,c.L,c.j,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:d0(c),P=g0(c,!0),F&&F(P),g.jo(z)}})};
g.N.yf=function(v){var F=this,c,S,J,A,C,P,z,U,n,r,h,Q;return g.M(function(u){switch(u.B){case 1:if(!F.B){zV(F,"onMaybeTransferStreamsExpired");u.A$(2);break}return m2o(F)?g.H(u,UO(F,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.H(u,pb7(F,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!F.L){u.A$(2);break}c=F.B;J=((S=c)==null?0:S.key)?g.Bx(c.key).entityId:"";if(!J){u.A$(2);break}return g.H(u,Pi(J,F.L,F.j,"DOWNLOAD_STATE_FAILED"),2);case 9:return F.B||zV(F,"onMaybeTransferStreamsExpiredRetryAttempting"),
A=F.B,P=((C=A)==null?0:C.key)?g.Bx(A.key).entityId:"",g.H(u,Qx(F,P),10);case 10:return z=u.j,u$({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:P,ZG:A,offlineModeType:z}),U=Fvt(),g.c1(U,l$,{isEnqueuedForExpiredStreamUrlRefetch:!0}),n=g.DB(P,"playbackData"),r={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:n,actionMetadata:U},h=LK(new TV("playbackData",P,r)),g.H(u,GV(F.j,h,"offlineOrchestrationActionWrapperEntity"),2);case 2:d0(F),Q=g0(F,!0),
v&&v(Q),g.jo(u)}})};
var tk7={},g2Z=(tk7.TRANSFER_STATE_TRANSFERRING=1,tk7.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,tk7);g.N=NA.prototype;g.N.PS=function(){return this.V.promise};
g.N.jd=function(){if(this.j&&this.W)return this.V.promise;ASt(this).then(this.V.resolve).catch(this.V.reject);return this.V.promise};
g.N.W9=function(v){var F={};return F.playbackData=new Ny7(v,this.Y,this.B),F.transfer=new k3d(v,this.Y),F.videoPlaybackPositionEntity=new mxZ(v,this.Y),F};
g.N.wm=function(){var v=this;return g.M(function(F){return v.j?g.H(F,prY(v.j),0):F.A$(0)})};
g.N.fZ=function(){var v=this,F,c;return g.M(function(S){if(S.B==1)return v.j||v.W?g.H(S,v.PS(),2):S.return();v.G!==void 0&&(g.E3(v.G),v.G=void 0);v.C!==void 0&&(g.E3(v.C),v.C=void 0);(F=v.j)==null||F.dispose();v.j=void 0;(c=v.W)==null||c.dispose();v.W=void 0;v.api.rS("onOrchestrationLostLeader");v.V=new g.jL;g.jo(S)})};
g.N.isOrchestrationLeader=function(){return this.L.B};
g.N.qZ=function(){return g.M(function(v){return v.return(!1)})};
g.N.iK=function(v){var F=this.B;F.api.publish("offlinetransferpause",v);var c;(c=F.j)==null||c.postMessage(v)};
g.N.x8=function(v){var F,c;return g.M(function(S){if(S.B==1)return g.H(S,a8(),2);F=S.j;if(!F)return S.return();c=g.DB(v,"transfer");return g.H(S,gX(F,{mode:"readwrite",cX:!0},function(J){var A=sO(J,c,"transfer"),C=sO(J,g.DB(v,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.zo.all([A,C]).then(function(P){P=g.k(P);var z=P.next().value;var U=P.next().value;return z&&z.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(z.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",yX(J,z,"transfer").then(function(){u$({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:v,ZG:z,offlineModeType:U==null?void 0:U.offlineModeType});return g.zo.resolve(null)})):g.zo.resolve(null)})}),0)})};
g.N.OM=function(v){v=v===void 0?43200:v;var F=this,c,S,J,A,C,P,z,U;return g.M(function(n){if(n.B==1)return F.K.xU()?g.H(n,a8(),2):n.return(zn7());if(n.B!=3){c=n.j;if(!c)return n.return([]);S=Date.now()/1E3;return g.H(n,tC(c,"offlineVideoPolicy"),3)}J=n.j;A=[];C=g.k(J);for(P=C.next();!P.done;P=C.next())z=P.value,Number(z.lastUpdatedTimestampSeconds)+v<=S&&(U=g.Bx(z.key).entityId,A.push(U));return A.length?n.return(o8(F,A,F.bX,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):n.return([])})};
g.N.deleteAll=function(){return o8(this,["!*$_ALL_ENTITIES_!*$"],this.bX,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.N.refreshAllStaleEntities=function(v){var F=this;return g.M(function(c){return c.B==1?g.H(c,F.OM(v),2):c.return(c.j)})};
g.N.setUpPositionSyncInterval=function(v){var F=this;this.C!==void 0&&(g.E3(this.C),this.C=void 0);var c=v!=null?v:864E5;this.C=g.bc(function(){F.AE(c)},c)};
g.N.AE=function(v){var F=this,c,S,J,A,C,P;return g.M(function(z){switch(z.B){case 1:return g.f1(z,2),g.H(z,Hi.getInstance(),4);case 4:c=z.j;if(!c)throw Error("prefStorage is undefined");return g.H(z,c.get("psi"),5);case 5:S=z.j;A=((J=S)==null?0:J.pG)?Number(S.pG)/1E3:0;C=Date.now();if(!(A+v<=C)){z.A$(6);break}return g.H(z,o8(F,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Ek(z,0);break;case 2:P=g.Lf(z),m9("Offline manager error",P),
g.jo(z)}})};
g.N.ek=function(){var v=this,F,c,S,J,A,C,P;return g.M(function(z){if(z.B==1)return g.H(z,a8(),2);if(z.B!=3)return(F=z.j)?g.H(z,tC(F,"transfer"),3):z.return([]);c=z.j;S=[];J=g.k(c);for(A=J.next();!A.done;A=J.next())C=A.value,C.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&C.key&&(P=g.Bx(C.key).entityId,S.push(P));return z.return(fV7(v,S))})};
g.N.XB=function(){return g.M(function(v){return v.return([])})};
g.N.z$=function(){return g.M(function(v){g.jo(v)})};
g.N.Q2=function(){return g.M(function(v){g.jo(v)})};g.d(u3t,I8);u3t.prototype.j=function(v){return m5(v)?Fa7(this,v):pK(v)?da7(this,v):vL(v)?IT7(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var Ix=[10];g.d(jLZ,I8);jLZ.prototype.j=function(v){return m5(v)?Nnj(this,v):pK(v)?DBo(this,v):vL(v)?ODt(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var uRd=[10];g.d($2j,I8);$2j.prototype.j=function(v){return pK(v)?o2Z(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.d(r0I,NA);g.N=r0I.prototype;g.N.W9=function(v){var F=NA.prototype.W9.call(this,v);F.mainVideoEntity=new jLZ(v,this.Y,this.B);F.mainPlaylistEntity=new u3t(v,this.Y,this.B);F.mainDownloadsListEntity=new $2j(v,this.Y,this.B);return F};
g.N.refreshAllStaleEntities=function(v,F){var c=this,S,J,A,C,P,z,U,n,r,h,Q;return g.M(function(u){switch(u.B){case 1:S=[];if(!c.Y.D("web_player_offline_playlist_auto_refresh")){u.A$(2);break}return g.H(u,K_I(c,v,F),3);case 3:S=u.j;case 2:return g.H(u,Hi.getInstance(),4);case 4:return J=u.j,g.H(u,(A=J)==null?void 0:A.get("sdois"),5);case 5:return C=u.j,g.H(u,(P=J)==null?void 0:P.get("lmqf"),6);case 6:z=u.j;if(!C){u.A$(7);break}n=S;r=n.concat;return g.H(u,UgI(c,C,(U=z)!=null?U:"SD",v===0),8);case 8:S=
r.call(n,u.j);case 7:return h=S,Q=h.concat,g.H(u,NA.prototype.refreshAllStaleEntities.call(c,v,F),9);case 9:return S=Q.call(h,u.j),u.return(S)}})};
g.N.qZ=function(v){var F,c,S,J,A,C,P,z;return g.M(function(U){if(U.B==1)return g.H(U,a8(),2);if(U.B!=3)return(F=U.j)?g.H(U,jb(F,g.Mn,"mainDownloadsListEntity"),3):U.return(!1);c=U.j;if((S=c)==null?0:(J=S.downloads)==null?0:J.length)for(A=g.DB(v,"mainVideoEntity"),C=g.k(c.downloads),P=C.next();!P.done;P=C.next())if(z=P.value,z.videoItem===A)return U.return(!0);return U.return(!1)})};
g.N.XB=function(){var v=this,F,c,S,J,A,C,P,z;return g.M(function(U){if(U.B==1)return g.H(U,a8(),2);if(U.B!=3)return(F=U.j)?g.H(U,tC(F,"downloadStatusEntity"),3):U.return([]);c=U.j;S=[];J=g.k(c);for(A=J.next();!A.done;A=J.next())C=A.value,C.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&C.key&&(P=g.Bx(C.key).entityId,S.push(P));return S.length?(z={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},U.return(o8(v,S,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
z))):U.return([])})};
g.N.Q2=function(){var v;return g.M(function(F){return F.B==1?g.H(F,a8(),2):(v=F.j)?g.H(F,gX(v,{mode:"readwrite",cX:!0},function(c){return e2(c,"mainVideoEntity").then(function(S){var J=[];S=g.k(S);for(var A=S.next();!A.done;A=S.next()){A=A.value;var C=void 0;(C=A.userState)!=null&&C.playbackPosition||(C=g.Bx(A.key).entityId,C={key:g.DB(C,"videoPlaybackPositionEntity"),videoId:C,lastPlaybackPositionSeconds:"0"},J.push(yX(c,C,"videoPlaybackPositionEntity")),A.userState={playbackPosition:C.key},J.push(yX(c,
A,"mainVideoEntity")))}return g.zo.all(J)})}),0):F.return()})};
g.N.z$=function(){var v,F,c,S,J,A,C,P,z,U,n,r,h,Q,u,D,w,G,O,a,T,m,b,X,AJ,C1,c3,n1,FJ,xW,tJ,zf,eY,T6,dO,p7,Y,H_;return g.M(function(PQ){if(PQ.B==1)return g.H(PQ,a8(),2);if(PQ.B!=3){v=PQ.j;if(!v)return PQ.return();F=g.DB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.H(PQ,gX(v,{mode:"readonly",cX:!0},function(yZ){return g.zo.all([sO(yZ,F,"mainDownloadsListEntity"),sO(yZ,g.Mn,"mainDownloadsListEntity"),e2(yZ,"mainVideoEntity"),e2(yZ,"mainPlaylistEntity")])}),3)}c=PQ.j;
S=g.k(c);J=S.next().value;A=S.next().value;C=S.next().value;P=S.next().value;z=J;U=A;n=C;r=P;h=new Set;if((Q=z)==null?0:(u=Q.downloads)==null?0:u.length)for(D=g.k(z.downloads),w=D.next();!w.done;w=D.next())G=w.value,O=void 0,(a=(O=G.videoItem)!=null?O:G.playlistItem)&&h.add(a);if((T=U)==null?0:(m=T.downloads)==null?0:m.length)for(b=g.k(U.downloads),X=b.next();!X.done;X=b.next())AJ=X.value,AJ.videoItem&&h.add(AJ.videoItem);C1=new Set;c3=[];n1=g.k(r);for(FJ=n1.next();!FJ.done;FJ=n1.next()){xW=FJ.value;
if(xW.videos)for(tJ=g.k(xW.videos),zf=tJ.next();!zf.done;zf=tJ.next())eY=zf.value,(T6=JSON.parse(g.Bx(eY).entityId).videoId)&&C1.add(T6);xW.key&&!h.has(xW.key)&&c3.push(xW.key)}dO=g.k(n);for(p7=dO.next();!p7.done;p7=dO.next())Y=p7.value,Y.key&&!h.has(Y.key)&&(H_=g.Bx(Y.key).entityId,C1.has(H_)||c3.push(Y.key));return c3.length?g.H(PQ,tHH(v,c3),0):PQ.A$(0)})};g.d(JEf,I8);JEf.prototype.j=function(v){return m5(v)?Gpf(this,v):pK(v)?PMZ(this,v):vL(v)?HDH(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var kT=[10];g.d(i3_,I8);i3_.prototype.j=function(v){return m5(v)?N$r(this,v):pK(v)?zPY(this,v):vL(v)?B$t(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var F8=[10];g.d(Vkr,I8);Vkr.prototype.j=function(v){return m5(v)?IVr(this,v):pK(v)?XPj(this,v):vL(v)?NFY(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var $gO=[10];g.d(yx,NA);yx.prototype.W9=function(v){var F=NA.prototype.W9.call(this,v);F.musicTrack=new Vkr(v,this.B);F.musicPlaylist=new i3_(v,this.B);F.musicAlbumRelease=new JEf(v,this.B);return F};
yx.prototype.refreshAllStaleEntities=function(v,F){var c=this,S,J,A;return g.M(function(C){if(C.B==1)return g.H(C,Bs7(c,v,F),2);if(C.B!=3)return J=S=C.j,A=J.concat,g.H(C,NA.prototype.refreshAllStaleEntities.call(c,v,F),3);S=A.call(J,C.j);return C.return(S)})};g.d(hbZ,g.Rv);g.N=hbZ.prototype;g.N.create=function(){var v=this;g.V(this,this.events);if(g.j3(this.Y))this.B=new r0I(this.Y,this.player);else if(g.Gk(this.Y)||g.vm(this.Y))this.B=new yx(this.Y,this.player);this.events.N(this.player,"onPlaybackStartExternal",function(){v.m7()});
this.events.N(this.player,"videodatachange",function(){v.m7()});
this.Y.D("html5_offline_playback_position_sync")&&this.events.N(this.player,"presentingplayerstatechange",this.R6)};
g.N.EE=function(){return!1};
g.N.l0=function(v,F,c,S){var J=this;return g.M(function(A){return J.B?A.return(o8(J.B,v,F,c,S)):A.return(Promise.reject())})};
g.N.deleteAll=function(){return this.B.deleteAll()};
g.N.OM=function(v){return this.B.OM(v)};
g.N.refreshAllStaleEntities=function(v){return this.B.refreshAllStaleEntities(v)};
g.N.setUpPositionSyncInterval=function(v){this.B.setUpPositionSyncInterval(v)};
g.N.iK=function(v){this.B.iK(v)};
g.N.x8=function(v){return this.B.x8(v)};
g.N.m7=function(){var v=this,F;return g.M(function(c){F=v.player.getVideoData();return g.Ak(F)?dBH(F)&&v.j!==F.clientPlaybackNonce?g.H(c,a1Y(v,F),0):c.A$(0):c.return()})};
g.N.R6=function(v){var F=this,c,S,J,A,C,P,z;return g.M(function(U){if(U.B==1)return c=F.player.getVideoData(),S=c.Mw,g.Ye(v,2)||g.Ye(v,512)?g.H(U,a8(),2):U.return();if(U.B!=3){J=U.j;if(!J)return m9("PES is undefined"),U.return();A=c.videoId;return g.H(U,jb(J,g.DB(A,"mainVideoEntity"),"mainVideoEntity"),3)}C=U.j;if(!C)return U.return();P=Math.floor(S).toString();z={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:P}};return g.H(U,F.l0([A],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
z),0)})};
g.N.isOrchestrationLeader=function(){return this.B.isOrchestrationLeader()};
g.N.updateDownloadState=function(v,F){var c,S,J,A;return g.M(function(C){if(C.B==1)return g.H(C,a8(),2);c=C.j;if(!c)return m9("PES is undefined"),C.return();S=g.Bx(v);J=S.entityType;A=S.entityId;return g.H(C,Pi(A,J,c,F,!0),0)})};g.Mk("offline",hbZ);})(_yt_player);
